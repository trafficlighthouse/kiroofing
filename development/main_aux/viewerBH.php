<?php require_once "./class_dbase.php";  $mem_sel_find = (isset($_GET['MSF']))? $_GET['MSF'] : 'dest'; $mem_inp_find = (isset($_GET['MIF']))? $_GET['MIF'] : ''; $mem_found = (isset($_GET['FV']))? $_GET['FV'] : '';  $xh_var = array(); if(isset($_GET['FS'])) { $xh_src = ($_GET['FS'] == 1)? '' : 'h_hide'; $xh_dst = ($_GET['FD'] == 1)? '' : 'h_hide'; $xh_var = array_fill(0,9,''); for($x=1;$x<10;$x++) { if(! isset($_GET['V'.$x])) continue; if($_GET['V'.$x] == 0) $xh_var[$x-1] = 'h_hide'; } } else { $xh_src = ''; $xh_dst = ''; $xh_var = array_fill(0,9,''); }  $TESTING = $_GET['TESTING']; $VER = $_GET['VER']; $PERPAGE = $_GET['PERPAGE']; $XZ = $_GET['XZ']; $LINES = $_GET['LINES']; $CARET = $_GET['CARET']; $iInB = $_GET['iInB']; $xzvis = ($XZ == 1)? 'visible':'hidden'; $bpTime = $_GET['bpTime'];  $vparm = "'$iInB', '$TESTING', '$VER', '$CARET'";  if($TESTING == 1) { $ht_button = '../cssfiles/button.css'; $xGGcf5Xb0  = '../jsfiles/viewer.js'; } else { $ht_button ="css/mpc.button.$VER.min.css"; $xGGcf5Xb0 = "js/mpc.viewer.$VER.min.js"; }  if($LINES < $PERPAGE) { $iPages = 1; $currPage = 0; $nextPage = 0; $prevPage = 0; } else { $iPages = floor( ($LINES + $PERPAGE)/$PERPAGE ); $currPage = (isset($_GET['currPage']))? $_GET['currPage'] : 0; $prevPage = $currPage -1; if($prevPage < 0) $prevPage = $iPages -1; $nextPage = $currPage + 1; if($nextPage >= $iPages) $nextPage = 0; } $qs = "&TESTING=$TESTING&VER=$VER&PERPAGE=$PERPAGE&XZ=$XZ&LINES=$LINES&iInB=$iInB&CARET=$CARET&bpTime=$bpTime";  $dbBlue = new dbase('.', 'bh.db'); $retjson = $dbBlue->dumpBpPagesH($currPage, $currPage, 'bx.txt', $PERPAGE); $rj = json_decode($retjson); $yb1d40XxF = $rj->varcount; $iLegend = ( ($xh_src == '') && ($xh_dst == '') )? $rj->iLegend : 0;   $vc3 = $yb1d40XxF+3; $vlab = array_fill(0,8,' '); for($x=1;$x<$yb1d40XxF;$x++) { $vlab[$x-1] = @file_get_contents('snap/cp_txVar'.$x); } $ht_sbjs =  ($TESTING == 1)?    '../jsfiles/shadowbox.js' : "js/mpc.sbox.$VER.min.js"; $ht_sbcss = ($TESTING == 1)?  '../cssfiles/shadowbox.css' : "css/mpc.sbox.$VER.min.css"; ?> <!DOCTYPE html> <html> <head> <meta charset="utf-8" /> <title>MPC - Blueprint</title> <link  href="<?php echo $ht_button ?>" rel="stylesheet" type="text/css" /> <script src="<?php echo $xGGcf5Xb0 ?>"></script> <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" ></script> <script src="<?php echo $ht_sbjs ?>"></script> <link  href="<?php echo $ht_sbcss ?>" rel="stylesheet" type="text/css" /> <link rel="icon" type="image/png" href="images/favicon16.png" sizes="16x16"> <link rel="icon" type="image/png" href="images/favicon32.png" sizes="32x32">  <style type="text/css"> body { font-family:monospace; cursor:wait; font-size:12.8px; margin:0; padding:0; color:black; background-color:white; } #zwarn { position:fixed; top:0; right:0; font-size:12.8px; font-weight:bold; font-family:verdana,arial; padding:0 10px 1px; background-color:red; color:white; -moz-border-radius-bottomleft:5px; border-bottom-left-radius:5px; webkit-border-bottom-left-radius:5px; visibility:<?php echo $xzvis ?>; } #zwarn:hover { background-color:blue; } a, a:link, a:visited {color:blue;text-decoration:none;} a:hover {text-decoration:underline} td {text-align:left;padding:0;white-space:nowrap;}  .h_hide { color:#808080; }   #h_dst:hover, #h_src:hover, #h_var1:hover, #h_var2:hover, #h_var3:hover, #h_var4:hover, #h_var5:hover, #h_var6:hover, #h_var7:hover, #h_var8:hover, #h_var9:hover { background-color:#627aad; color:white; }  /* colors */ .def {background-color:#cbf0a6} .silo  { background-color:#ffec80; } .siloi { background-color:#b8e8ff; } .exten { background-color:#f0f0f0;color:#960096 } .ext   { color:#960096 } /* .silof {background-color:#aef1be} */  /* legend */ .hd { font-family:Verdana,Arial,sans-serif; border-style:solid; border-color: #808080; padding:3px 5px; margin:0; }  /* rounded corners */ .round-left { border-top-left-radius:5px; -moz-border-radius-topleft:5px; -webkit-top-left-border-radius:5px; border-bottom-left-radius:5px; -moz-border-radius-bottomleft:5px; -webkit-bottom-left-border-radius:5px; } .round-right { border-top-right-radius:5px; -moz-border-radius-topright:5px; -webkit-top-right-border-radius:5px; border-bottom-right-radius:5px; -moz-border-radius-bottomright:5px; -webkit-bottom-right-border-radius:5px; } .round-all { -moz-border-radius:5px; border-radius:5px; -webkit-border-radius:5px; } .found { background-color:pink }  /* borders */ .bw-tbl {border-width:1px 0 1px 1px } .bw-all {border-width:1px }  .sexybutton { z-index:99; } .tb_num  {text-align:right;padding:1px 10px;width:20px}  .th     {text-align:left;  padding:0  2px;font-weight:bold;width:10px} .thn    {text-align:right; padding:0 10px;font-weight:bold;width:10px} .thx    {text-align:left;  padding:0 10px;font-weight:bold;height:48px} .tb     {text-align:left;  padding:0  2px;width:10px} .tbx    {text-align:left;  padding:0 10px}  .odd {background-color:white} .even {background-color:#f0f0f0} .odd:hover, .even:hover {background-color:#b5d5ff} //.odd:active, .even:active {background-color:pink}  .bg-public { background-color:pink !important } .bg-google { background-color:lightgreen !important }   .noselect { -moz-user-select: -moz-none; -khtml-user-select: none; -webkit-user-select: none; cursor:default; }  select#sel_find { font-family:monospace; text-align:left; padding:2px 0; margin:0 0 0 15px; background:none; border:1px solid #808080; -moz-border-radius:5px; border-radius:5px; -webkit-border-radius:5px; }  input#inp_find { font-family:monospace; width:250px; padding:3px 0 3px 4px; margin:0 2px 0 2px; background:none; border:1px solid #808080; -moz-border-radius:5px; border-radius:5px; -webkit-border-radius:5px; } .pink {background-color:pink !important} </style>  <script> Shadowbox.init({skipSetup:true, animateFade:0, modal:true, enableKeys:false});  var vc = <?php echo $yb1d40XxF ?>; var iLegend = <?php echo $iLegend ?>; var lines = <?php echo $LINES ?>; var mem_sel_find = '<?php echo $mem_sel_find ?>'; var mem_inp_find = '<?php echo $mem_inp_find ?>'; var mem_found = '<?php echo $mem_found ?>'; var perpage = <?php echo $PERPAGE ?>; var iInB = <?php echo $iInB ?>;  function gofind(q) { if(mem_found != '') jQuery('#ln'+mem_found).parent().parent().toggleClass('found', false);  var j_inp_find = jQuery('#inp_find');  var value = j_inp_find.val(); value = value.trim(); if(value == '') { j_inp_find.toggleClass('pink', true); j_inp_find.focus(); return; } var table = jQuery('#sel_find').val(); if(table == 'line') { value = value.replace(/,/g, ''); if( value.search(/[^0-9]/) != -1 ) return; if(value < 1) value = 1; if(value > lines) value = lines; }  dim();  jQuery.post('bpfind.php', { tbl:table, val:value }, function(r) { j = jQuery.parseJSON(r); if(j.status == 'ng') { undim(); j_inp_find.toggleClass('pink', true); j_inp_find.focus(); return; }  var newpage;  var newoffset;  if(j.value < perpage) { newpage = 0; } else { newpage = Math.floor(j.value/perpage); } newoffset = j.value - (newpage*perpage);  var scrollto = (newoffset < 5)? '' : '#ln'+(j.value-5);   var v = '&FV='+j.value;  var r = '&RND='+j.rand; var x; var s; var z; z = (jQuery('#h_src').hasClass('h_hide'))? 0 : 1; s = '&FS='+z; z = (jQuery('#h_dst').hasClass('h_hide'))? 0 : 1; s += '&FD='+z;  for(x=1;x<vc;x++) { z = (jQuery('#h_var'+x).hasClass('h_hide'))? 0 : 1; s += '&V'+x+'='+z; } var f = '&MSF='+jQuery('#sel_find').val()+'&MIF='+j_inp_find.val(); location.href='viewerBH.php?currPage='+newpage+r+q+s+f+v+scrollto; } ); }  function gopage(q) { dim();  var x; var s; var z; z = (jQuery('#h_src').hasClass('h_hide'))? 0 : 1; s = '&FS='+z; z = (jQuery('#h_dst').hasClass('h_hide'))? 0 : 1; s += '&FD='+z; for(x=1;x<vc;x++) { z = (jQuery('#h_var'+x).hasClass('h_hide'))? 0 : 1; s += '&V'+x+'='+z; } var f = '&MSF='+jQuery('#sel_find').val()+'&MIF='+jQuery('#inp_find').val(); location.href='viewerBH.php?currPage='+q+s+f; }  function dim() { jQuery('body' ).css('cursor', 'wait'); jQuery('.pn' ).prop('disabled', true); jQuery('.pnc' ).prop('disabled', true); var j = jQuery('#sel_find'); j.css('background', 'none'); j.prop('disabled', true); j = jQuery('#inp_find'); j.css('background', 'none'); j.prop('disabled', true); }  function undim() { jQuery('body' ).css('cursor', 'auto'); jQuery('.pn' ).prop('disabled', false); jQuery('.pnc' ).prop('disabled', false); var j = jQuery('#sel_find'); j.css('background', 'white'); j.prop('disabled', false); j = jQuery('#inp_find'); j.css('background', 'white'); j.prop('disabled', false); }  /* Show list of missing Zipcodes */ function viewZip(inb, test, ver, caret) { if(inb == 1) { reportz = window.open('viewerZIP.php?TESTING='+test+'&VER='+ver+'&CARET='+caret); } else { reportz = window.open('viewerZIP.php?TESTING='+test+'&VER='+ver+'&CARET='+caret, 'rept', 'height='+screen.availHeight*.9+', width='+screen.availWidth*.95+', scrollbars=yes,resizable=yes'); } }  jQuery(document).ready(function() { var ar = new Array('num', 'src', 'dst'); var j,x; for(x=0;x<3;x++) { j = jQuery('#th_'+ar[x]); j.css('width', j[0].getBoundingClientRect().width); jQuery('#tb_'+ar[x]+'1').css('width', j[0].getBoundingClientRect().width); } for(x=1;x<vc;x++) { j = jQuery('#th_var'+x); j.css('width', j[0].getBoundingClientRect().width); jQuery('#tb_var'+x).css('width', j[0].getBoundingClientRect().width); } jQuery('#tban').css('position', 'fixed'); jQuery('#tpad').css('display', 'block'); jQuery('.pnc' ).prop('disabled', false);  var j = jQuery('#sel_find'); j.css('background', 'white'); j.prop('disabled', false); j = jQuery('#inp_find'); j.css('background', 'white'); j.prop('disabled', false);  if(lines > (perpage-1)) jQuery('.pn' ).prop('disabled', false); jQuery('body' ).css('cursor', 'default'); jQuery('#sel_find').val(mem_sel_find); jQuery('#inp_find').val(mem_inp_find);   var oldScroll = 0; jQuery(function() { jQuery(window).scroll(function() { var hs = jQuery(window).scrollLeft(); if(oldScroll != hs) { oldScroll = hs; jQuery('#tban').css('left', '-'+hs+'px'); jQuery('#ctrl').css('left', '-'+hs+'px'); } }); });  jQuery(function() { jQuery('.hc').click(function() { var j = jQuery('#'+this.id); if(j.hasClass('h_hide')) { j.toggleClass('h_hide', false); } else { j.toggleClass('h_hide', true); } gopage('<?php echo $currPage.$qs ?>'); }); });  jQuery(function() { jQuery('#sel_find').change(function() { if(mem_found != '') jQuery('#ln'+mem_found).parent().parent().toggleClass('found', false); }); });  jQuery(function() { jQuery('#inp_find').click(function() { jQuery('#inp_find').toggleClass('pink', false); if(mem_found != '') jQuery('#ln'+mem_found).parent().parent().toggleClass('found', false); }); });  jQuery(function() { jQuery('#inp_find').keypress(function(e) { jQuery('#inp_find').toggleClass('pink', false); if(e.which == 13) { jQuery('#bnFind').click(); return false; } }); });  jQuery(function() { jQuery('#inp_find').change(function() { jQuery('#inp_find').toggleClass('pink', false); }); });  jQuery(function() { jQuery('.vtr').mousedown(function(event) { if(event.which == 1) { jQuery('#'+this.id).toggleClass('bg-public', true); } else { jQuery('#'+this.id).toggleClass('bg-google', true); } return false; }); });  jQuery(function() { jQuery('.vtr').mouseout(function(event) { jQuery('#'+this.id).toggleClass('bg-public', false); jQuery('#'+this.id).toggleClass('bg-google', false); return false; }); });  jQuery(function() { jQuery('.vtr').mouseup(function(event) { jQuery('#'+this.id).toggleClass('bg-public', false); jQuery('#'+this.id).toggleClass('bg-google', false); MpcViewer.bpSel(this.id, event.which, iInB); return false; }); });  jQuery('#inp_find').focus();  document.oncontextmenu = function(event) { if(event.preventDefault != undefined) event.preventDefault(); if(event.stopPropagation != undefined) event.stopPropagation(); return false; } }); </script> </head> <body class="noselect"> <!-- controls --> <div id="ctrl" style="position:fixed;top:0;left:0;height:21px;width:497px;padding:5px 4px;background:none;z-index:99"> <table> <tr> <td> &nbsp;<button class="sexybutton sexyicononly pn" disabled="disabled" title="Previous page of lines" onclick="gopage('<?php echo $prevPage.$qs ?>')"> <span><span><span class="prev">&nbsp;</span></span></span></button> </td> <td> <div style="margin:0 2px"> <button class="sexybutton sexyicononly pn" disabled="disabled" title="Next page of lines" onclick="gopage('<?php echo $nextPage.$qs ?>')"> <span><span><span class="next">&nbsp;</span></span></span></button> </div> </td> <td> <button class="sexybutton pnc" disabled="disabled" title="Close listing" onclick="window.close();return false"><span><span><span class="cancel">Close</span></span></span></button> </td>  <td> <select id="sel_find" disabled="disabled"> <option value="line" <?php if($mem_sel_find == 'line') echo 'selected' ?>>Line number</option> <option value="src" <?php if($mem_sel_find == 'src') echo 'selected' ?>>Source</option> <option value="dest" <?php if($mem_sel_find == 'dest') echo 'selected' ?>>Destination</option> <?php for($x=1;$x<$yb1d40XxF;$x++) { if($vlab[$x-1] == '') continue;  $chk = ($mem_sel_find == "v$x")? 'selected' : ''; echo '<option value="v'.$x.'" '.$chk.'>Var'.$x.': '.$vlab[$x-1].' </option>'; } ?> </select> <td>  <td><input id="inp_find" placeholder="search term" disabled="disabled" spellcheck="false" value="<?php echo $mem_inp_find ?>" /></td>  <td> <button class="sexybutton pnc" id="bnFind" disabled="disabled" title="Find in Blueprint" onclick="gofind('<?php echo $qs ?>')"><span><span><span class="search">Find</span></span></span></button> </td>  <td style="width:15px"><div style="width:15px"></div></td>  <td><span class="def hd round-left bw-tbl">default</span><span class="silo hd bw-tbl">silo</span><span class="siloi hd bw-tbl">index</span><span class="exten hd round-right bw-all">ext</span></td> <td style="width:15px"><div style="width:15px"></div></td> <td><div><?php echo $bpTime ?></div></td> </tr> </table> </div>  <div id="tpad" style="height:51px;width:100%;background-color:#c4c4c4;display:none">&nbsp;</div>   <!-- thead --> <table style="width:100%;text-align:left"> <thead id="tban" style="position:auto;top:0;left:0;width:4000px;background-color:#c4c4c4"> <tr> <td class="thn"><div id="th_num"><br><br><?php echo number_format($LINES) ?></div></td> <td class="th"><div id="th_src"><br><br><span id="h_src" class="hc <?php echo $xh_src ?>" title="show-hide Source">&nbsp;Source&nbsp;</span></div></td> <td class="th"><div id="th_dst"><br><br><span id="h_dst" class="hc <?php echo $xh_dst ?>" title="show-hide Destination">&nbsp;Destination&nbsp;</span></div></td> <?php for($x=1;$x<$yb1d40XxF;$x++) { echo '<td class="th"><div id="th_var'.$x.'"><br><span id="h_var'.$x.'" class="hc '.$xh_var[$x-1].'" title="show-hide Var '.$x.'"><br>&nbsp;'.$vlab[$x-1].'&nbsp;</span></div></td>'; } ?> <td class="thx">&nbsp;</td> </tr> <tr><td colspan="<?php echo $vc3 ?>"><div style="height:2px;border-bottom:1px solid #808080"></div></td></tr> </thead>  <!-- tbody --> <tbody> <?php $xx2D3XA2F = fopen('./tmp/bx.txt', 'r'); $linecnt = ($currPage == 0)? 1 : 0; $rownum = 1; $found_num = (isset($_GET['FV']))? $_GET['FV'] : 0; while(($line = fgets($xx2D3XA2F)) !== false) { $rn = $rownum; $ar = explode("\t", trim($line)); $rowclass = ($rownum++ & 1 == 1)?  'odd':'even';  $n = $currPage*$PERPAGE+$linecnt++; $c = sprintf('%03d',$n); $fnd_class = ($c == $found_num)? 'found round-all' : '';  if($n > 999) $c = number_format($c); echo '<tr class="'.$rowclass.' vtr" id="tr'.$n.'">'; echo '<td class="tb_num '.$fnd_class.'"><div id="tb_num'.$rn.'"><div id="ln'.$n.'">'.$c.'</div></div></td>';  if($xh_src == 'h_hide') { $s = ''; } else { $xF0F1beXf = substr($ar[2], -2); $bh_def = ( ($xF0F1beXf == '_(') || ($xF0F1beXf == '_)') )? 'def round-all' : ''; $s = $ar[1]; } if($rn == 1) echo '<td class="tb"><div id="tb_src1" class="bh_src '.$bh_def.'">&nbsp;'.$s.'&nbsp;</div></td>'; else         echo '<td class="tb"><div class="bh_src '.$bh_def.'">&nbsp;'.$s.'&nbsp;</div></td>';  if($xh_dst == 'h_hide') { $d = ''; } else { $_path = str_replace('//', "\t", $ar[0]); $_path = preg_replace('#(\S+)\t#', '<span class="silo round-all">&nbsp;$1&nbsp;</span>/', $_path); $d = $ar[2]; switch(substr($d, -2)) { case '_#': case '_)': $d = substr($d, 0, -2); $d = trim($_path,'/').'<span class="ext">'.$d.'&nbsp;</span>'; break; case '_@': $d = substr($d, 0, -2); $d = $_path.'<span class="siloi round-all">&nbsp;'.$d.'&nbsp;</span>'; break; case '_(': $d = substr($d, 0, -2); $d = trim($_path,'/').'/'.$d; break; default: $d = trim($_path,'/').'/'.$d; break; } } if($rn ==1) echo '<td class="tb bh_dst"><div id="tb_dst1">&nbsp;'.$d.'&nbsp;</div></td>'; else        echo '<td class="tb bh_dst">&nbsp;'.$d.'&nbsp;</td>';  for($x=1;$x<$yb1d40XxF;$x++) { if($xh_var[$x-1] == 'h_hide') { $v = ''; } else { $v = $dbBlue->getVarValue($ar[$x+3]); } if($rn == 1) echo '<td class="tb"><div id="tb_var'.$x.'">&nbsp;'.$v.'&nbsp;</div></td>'; else         echo '<td class="tb">&nbsp;'.$v.'&nbsp;</td>'; }  echo '<td class="tbx">&nbsp;</td>'; echo '</tr>'; } echo '</tbody>'; echo '</table>'; fclose($xx2D3XA2F); $dbBlue->close(false); ?> <div onclick="viewZip(<?php echo $vparm ?>);return false" id="zwarn">Show missing zipcodes</div> </body> </html>