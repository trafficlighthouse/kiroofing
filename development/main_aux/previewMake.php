<?php require_once('iccheck.php'); require_once 'table3.php'; require_once 'spin.php'; define('x0dE1fXCF', 3); define('yB4057Xbf',   0); define('y3ED3cXF7',  10); define('yx213dXa3', 11); define('SPIN_NONE', 0); define('SPIN_NO',   1);    $file = (isset($_GET['FILE']))? $_GET['FILE'] : ""; $tmpfile = 'tmp.'.$file; $rawfile = 'raw.'.$file;  $tag = $_GET['tag'];  $yXdB86X29 = yB4057Xbf; $y2c53aXEa = 'ok'; $xEG154XF3 = ""; $xx213dXa3 = ""; $x3ED3cXF7 = ""; $Project;  switch($tag) { case 'respin': $bArticle = ($rawfile == 'raw.a.htm'); $VER = $_POST['VER']; $TESTING = $_POST['TESTING']; try { xeA512X03('file:preview.db?immutable=1'); } catch(Exception $e) { if($e->getMessage() == 't'); $xF8598X1F = '<h3>More than 24 hours have elapsed since previous login.<p>Please log out and back in.</p></h3>'; break; } $xF8598X1F = file_get_contents('dst.x.htm'); break; case 'bn404': do404(); break;  case 'bnPre': $bArticle = ($rawfile == 'raw.a.htm'); $VER = $_POST['VER']; $webRoot = $_POST['webRoot']; $TESTING = $_POST['TESTING']; $Project = json_decode(file_get_contents('jsettings')); $xF8598X1F = base64_decode( str_replace( array('-','_','.'),array('+','/','='), $_POST['DATA64'] ) ); $postV9 = base64_decode( str_replace( array('-','_','.'),array('+','/','='), $_POST['varNine'] ) ); $obj = json_decode($postV9, false); $arVarNine = $obj->v9; if( ($xF8598X1F != "") && ($webRoot != 1) ) { $yXdB86X29 = statCanonical(); { if($yXdB86X29 != 0) { $y2c53aXEa = 'okns'; break; } }  $xF8598X1F = str_replace('/#url!:h#', '#', $xF8598X1F); $vlab = getVarLabels(); xC2E8eXa9($vlab, $xF8598X1F);      $x3ED3cXF7 = array_fill(0,10,' '); for($x=0;$x<9;$x++) { $x3ED3cXF7[x0dE1fXCF+1+$x] = $arVarNine[$x]; }                    ycAc83X77($xF8598X1F);  $xF8598X1F = preg_replace_callback('/\<(style|script)\b[^\>]*?>.*?\<\/\\1\>/is', '_set_xospinCback', $xF8598X1F);  $spin_stat = SPIN_NONE; $xspin_stat = ''; $xF8598X1F = preg_replace_callback('/(?:\<!-- ?)?(\[\/?[ndx]ospin\])(?: ?--\>)?/i', '_fix_nospinCback', $xF8598X1F); if($spin_stat != SPIN_NONE) $xF8598X1F .= '[/nospin]';  $s = array( '/!domain-url!/',   '/!project-url!/',  '/!project-path!/', '/!webroot-path!/'  ); $r = array( $obj->domurl, $obj->pfurl, $obj->pfurl, $obj->domurl ); $xF8598X1F = preg_replace($s,$r,$xF8598X1F);  $xF8598X1F = preg_replace_callback('/\[\s*mpc-shortcode:\s*youtube\s*(\{.+?\})\s*\]/i', '_youtubeCback', $xF8598X1F); $xF8598X1F = preg_replace_callback('/\[\s*mpc-shortcode:\s*silo_table\s*(.+?)\s*\]/i', '_silotableCback', $xF8598X1F); $xF8598X1F =    preg_replace_callback('/\[\s*mpc-shortcode:\s*yelp\s*(\{.+?\})\s*\]/i', '_yelpCback', $xF8598X1F); $xF8598X1F =            preg_replace('/\[\s*mpc-shortcode:\s*(var_redir|redir|var_overlay|overlay|var_dyna|dyna)\s*(\{.+?\})\s*\]/i', '', $xF8598X1F);  xDe9159X6(); if(xece7fXCC() != 0) { $yXdB86X29 = y3ED3cXF7; restoreBraces(); $y2c53aXEa = 'okbr'; break; }  file_put_contents($rawfile, $xF8598X1F);  if(isNoSpinWarning()) { $yXdB86X29 = yx213dXa3; restoreBraces(); $y2c53aXEa = 'okns'; break; }  if(file_exists('preview.db')) unlink('preview.db'); $db = new SQLite3('preview.db'); $db->exec('BEGIN TRANSACTION;'); yXfx2dX23($db, 1, 0); $db->exec('COMMIT;'); $db->exec('BEGIN TRANSACTION;'); $db->exec("INSERT INTO source (id, path) VALUES (1, '$rawfile');"); $db->exec("INSERT INTO page (id, src, dest, curr_var, prev_var, next_var, filter_id) VALUES (1, 1, 'dst.x.htm', 1, 1, 1, ".yebF1dXC9.");"); $db->exec("INSERT INTO varset (id, num, var_id) VALUES (1, 1, 1);"); $db->exec("INSERT INTO var (id, value) VALUES (1, '');"); $db->exec('COMMIT;'); $db->close();  try { xBaA11X6G('file:preview.db?immutable=1'); } catch(Exception $e) { $emsg = $e->emsg; } $xF8598X1F = file_get_contents('dst.x.htm'); } break; }  if(($file=="")||($xF8598X1F==""))  { header('Content-type: text/html'); echo '???'; exit(); } if($TESTING == 1) { $ht_sbcss = '../cssfiles/shadowbox.css'; $ht_sb    = '../jsfiles/pv.shadowbox.js'; }   else {   $ht_sbcss = "css/mpc.sbox.$VER.min.css"; $ht_sb    = "js/pv.sbox.$VER.min.js"; }   if(! $bArticle) { if($yXdB86X29 != yB4057Xbf) {   $mpcBox = 'mpcWarnBox'; $warnT = 'Spintax warning'; $warnH = '305'; $warnW = '550'; $warnQ = 'nospin'; $warnE = yx213dXa3;  if ($yXdB86X29 < y3ED3cXF7) { $warnT = 'Canonical links found'; $warnQ = 'canon'; $warnH = '243'; $warnW = '550'; $warnE = $yXdB86X29; }  if($yXdB86X29 == y3ED3cXF7)  { $mpcBox = 'mpcErrorBox'; $warnE = y3ED3cXF7; }  if(preg_match("/(<head[^<]*?>)/i", $xF8598X1F, $m, PREG_OFFSET_CAPTURE) == 1) { $pos = $m[1][1] + strlen($m[1][0]);  $rstr  = "\n"; $rstr .= "<link  href='$ht_sbcss' rel='stylesheet' />"; $rstr .= "<script src='//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>"; $rstr .= "<script>var jQuery_mpc = $.noConflict(true);</script>"; $rstr .= "<script src='$ht_sb'></script>"; $rstr .= '<script>'; $rstr .=    "Shadowbox.init({animateFade:0,modal:true,enableKeys:false});";  $rstr .=    "function mpcErrorBox(){"; $rstr .=        "Shadowbox.open({"; $rstr .=            "content: 'previewErr.php?ecnt=10&VER=${VER}&TESTING=${TESTING}',"; $rstr .=            "title: 'Spintax error',"; $rstr .=            "player: 'iframe',"; $rstr .=            "handleOversize: 'none',"; $rstr .=            "modal: true,"; $rstr .=            "options:{animate:true, loadingColor:'pink', bodyColor:'pink'},"; $rstr .=            "height: 126,"; $rstr .=            "width: 550"; $rstr .=        "});"; $rstr .=    "}";  $rstr .=    "function mpcWarnBox(){"; $rstr .=        "Shadowbox.open({"; $rstr .=            "content: 'previewErr.php?ecnt=${warnE}&VER=${VER}&TESTING=${TESTING}',"; $rstr .=            "title:'$warnT',"; $rstr .=            "player: 'iframe',"; $rstr .=            "handleOversize: \"none\","; $rstr .=            "modal: true,"; $rstr .=            "options:{qmarkTarget:'$warnQ', animate:true, loadingColor:'#c4c4c4', bodyColor:'#c4c4c4'},"; $rstr .=            "height: $warnH,"; $rstr .=            "width: $warnW"; $rstr .=        "});"; $rstr .=    "}";  $rstr .=    "if(window.addEventListener) {window.addEventListener('load', $mpcBox, false);}"; $rstr .=    "else if (window.attachEvent) {window.attachEvent('onload', $mpcBox);}"; $rstr .=    "else {document.addEventListener('load', $mpcBox, false);} "; $rstr .= '</script>'; $xF8598X1F = substr_replace($xF8598X1F,$rstr,$pos,0); } }  header('Content-type: text/html'); $x6614XE05 = fopen($tmpfile, 'w'); if(!$x6614XE05) { echo 'open error. file='.$tmpfile; exit(); } fwrite($x6614XE05,$xF8598X1F); fclose($x6614XE05); if($tag == 'respin') { echo mt_rand(); exit(); } echo $y2c53aXEa; exit(); }    if($bArticle) { $adivColor = 'white'; $adivBack = '#008000'; $adivMsg = "Everything below this line is Article Content"; $arArticle = parseArticle($xF8598X1F);  if($arArticle['status'] != 'ok') { switch($arArticle['status']) { case 'notitle': $rstr  = "<div class=\"iwarning\">"; $rstr .= "This article does not have a properly configured Title.<br /><br />"; $rstr .= "Instructions (from Mpc to the WP plugin) are placed at the beginning of articles. These Instructions are optional EXCEPT for the Title. The Title is REQUIRED."; $rstr .= "<br /><br />"; $rstr .= "Follow these steps to correct the problem:"; $rstr .= "<ol>"; $rstr .= "<li>Using the Online Editor, click the 'WP Instruction' button.</li>"; $rstr .= "<li>Select <b>Title</b> and enter a title into the textbox.</li>"; $rstr .= "<li>Click 'Insert Instruction' and 'Done'.</li>"; $rstr .= "<li>Click 'Preview Article' again to verify your corrections.</li>"; $rstr .= "<li>Be sure to click 'Save Article' to make your changes permanent.</li>"; $rstr .= "</ol>"; $rstr .= "</div>"; $arArticle['content'] = $rstr; break;  case 'wpurl': $rstr  = "<div class=\"iwarning\">"; $rstr .= "<br>This article contains the obsolete instruction [Wordpress<scan class='preview-dred'>Url</scan>]."; $rstr .= "<br><br>Please replace with [Wordpress<scan class='preview-dgreen'>Slug</scan>]."; $rstr .= "</div>"; $arArticle['content'] = $rstr; break;  case 'nbsp': $m = str_replace('&nbsp;', '<scan class="preview-dred">&amp;nbsp;</scan>', $arArticle['title']);  $rstr  = "<div class=\"iwarning\">"; $rstr .= "The article Title contains <b>html</b> entities for 'spaces'."; $rstr .= "<div class=\"preview-gray-box-div\">"; $rstr .= "<span class=\"preview-gray-box\">$m</span>"; $rstr .= "</div>"; $rstr .= "The <b>html-spaces</b> need to be replaced with <b>text-space</b> characters."; $rstr .= " Follow these steps to correct the problem:"; $rstr .= "<ol>"; $rstr .= "<li>To make <b>html-spaces</b> visible, place the Online Editor into 'Source' mode (the 'Source' button turns blue).</li>"; $rstr .= "<li>Replace all <span class=\"preview-boxr\">&amp;nbsp;</span> entities in the Title with a press of the Spacebar.</li>"; $rstr .= "<li>Click 'Preview Article' again to verify your corrections.</li>"; $rstr .= "<li>Be sure to click 'Save Article' to make your changes permanent.</li>"; $rstr .= "</ol>"; $rstr .= "</div>"; $arArticle['content'] = $rstr; break;  case 'htmltags': $t = $arArticle['title']; $xAE0118X8 = strlen($t); $m = ""; for($x=0;$x<$xAE0118X8;$x++) { $c = substr($t,$x,1); if($c == '<') { $m .= '<scan class="preview-dred">&lt;</scan>'; continue; } if($c == '>') { $m .= '<scan class="preview-dred">&gt;</scan>'; continue; } $m .= $c; } $rstr  = "<div class=\"iwarning\">"; $rstr .= "The article Title contains <b>html</b> tags."; $rstr .= "<div class=\"preview-gray-box-div\">"; $rstr .= "<span class=\"preview-gray-box\">$m</span>"; $rstr .= "</div>"; $rstr .= "Titles must be <b>text only</b>. Html tags cannot be used."; $rstr .= "Follow these steps to correct the problem:"; $rstr .= "<ol>"; $rstr .= "<li>To make <b>html tags</b> visible, place the Online Editor into 'Source' mode (the 'Source' button turns blue).</li>"; $rstr .= "<li>Remove all <span class=\"preview-boxr\">&lt;html tags&gt;</span>.</li>"; $rstr .= "<li>Click 'Preview Article' again to verify your corrections.</li>"; $rstr .= "<li>Be sure to click 'Save Article' to make your changes permanent.</li>"; $rstr .= "</ol>"; $rstr .= "If you want to include '&lt;' and '&gt;' brackets in your titles:"; $rstr .= "<ul>"; $rstr .= "<li>When the Online Editor is in 'Source' mode, type <scan class=\"preview-boxg\">&amplt;</scan> or <scan class=\"preview-boxg\">&ampgt;</scan>."; $rstr .= "<li>When the Online Editor is in 'Visual' mode, type <scan class=\"preview-boxg\">&lt;</scan> or <scan class=\"preview-boxg\">&gt;</scan>."; $rstr .= "</ul>"; $rstr .= "</div>"; $arArticle['content'] = $rstr; break; } $yXdB86X29 = yB4057Xbf; $adivBack = '#d54e21'; $adivColor = 'white'; $adivMsg = "A problem has been found in the article Instruction lines"; }  $onloadmsg = "";  if($yXdB86X29 == y3ED3cXF7) { $adivBack = '#d54e21'; $adivColor = 'white'; $adivMsg = "Spintax problem found. Unmatched braces"; $onloadmsg = "onload=\"mpcErrorBox();return false\""; } elseif($yXdB86X29 != yB4057Xbf) { $onloadmsg = "onload='mpcWarnBox();return false'"; }  $rstr  = "<!DOCTYPE html>"; $rstr .= "<html><head><title>Preview Article</title>"; $rstr .= "<meta charset=\"utf-8\">\n"; $rstr .= "<link  href=\"$ht_sbcss\" rel=\"stylesheet\" type=\"text/css\" />\n"; $rstr .= "<style type=\"text/css\">"; $rstr .= "body {margin:2px 0 0 0}"; $rstr .= ".preview-cmd {white-space:nowrap;font-weight:bold;text-align:right;padding:2px 5px;margin-bottom:2px;background-color:#e1f0fd;}"; $rstr .= ".preview-value {font-weight:normal;text-align:left;padding:2px 5px;margin-bottom:2px;white-space:normal;background-color:#e1f0fd;}"; $rstr .= "#preview-divider {font-size:.8em;font-family: Verdana,Arial,Helvetica,sans-serif;font-weight:bold;text-align:center;background-color:$adivBack;color:$adivColor;padding:4px 0;}"; $rstr .= "#preview-prompt {font-size:.8em;font-family: Verdana,Arial,Helvetica,sans-serif;}"; $rstr .= "#preview-prompt a:link, #preview-prompt a:visited {color:blue;text-decoration:none;}"; $rstr .= "#preview-prompt a:hover {text-decoration:underline;}"; $rstr .= "#preview-table {width:100%;}"; $rstr .= ".preview-cmd-td {width:1%;}"; $rstr .= ".preview-dred {color:#c00000;font-weight:bold}"; $rstr .= ".preview-dgreen {color:#008000;font-weight:bold}"; $rstr .= ".preview-boxr {color:#c00000;background-color:#f0f0f0;padding:0 2px;font-family:monospace;font-weight:bold}"; $rstr .= ".preview-boxg {color:#008000;background-color:#f0f0f0;padding:0 2px;font-family:monospace;font-weight:bold}"; $rstr .= ".preview-gray-box {padding:8px 0}"; $rstr .= ".preview-gray-box-div {padding:8px 10px;margin:4px 0 20px;font-family:monospace;color:black;background-color:#f0f0f0;border:1px solid #808080}"; $rstr .= ".iwarning {"; $rstr .= "  font-family:Verdana,Arial,Helvetica,sans-serif;font-size:12.8px;line-height:1.4em"; $rstr .= "}"; $rstr .= "</style>\n"; $rstr .= "<script src=\"//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js\" type=\"text/javascript\"></script>\n"; $rstr .= "<script>var jQuery_mpc = $.noConflict(true);</script>"; $rstr .= "<script src=\"$ht_sb\" type=\"text/javascript\"></script>"; $rstr .= "<script type=\"text/javascript\">"; $rstr .= "Shadowbox.init({animateFade:0,modal:true,enableKeys:false});\n"; $rstr .= "function mpcErrorBox()\n"; $rstr .= "{\n"; $rstr .= "  Shadowbox.open({\n"; $rstr .= "    content: 'previewErr.php?ecnt=1&VER=${VER}&TESTING=${TESTING}', title:'Spintax error',\n"; $rstr .= "    player:     'iframe',\n"; $rstr .= "   handleOversize: \"none\",\n"; $rstr .= "   modal: true,\n"; $rstr .= "   options:{animate:true,loadingColor:'pink',bodyColor:'pink'},\n"; $rstr .= "      height:     100,\n"; $rstr .= "      width:      550\n"; $rstr .= "  });\n"; $rstr .= "}\n"; $rstr .= "function mpcWarnBox()\n"; $rstr .= "{\n"; $rstr .= "  Shadowbox.open({\n"; $rstr .= "    content: 'previewErr.php?ecnt=2&VER=${VER}&TESTING=${TESTING}', title:'Spintax warning',\n"; $rstr .= "    player:     'iframe',\n"; $rstr .= "   handleOversize: \"none\",\n"; $rstr .= "   modal: true,\n"; $rstr .= "   options:{qmarkTarget:'nospin',animate:true, loadingColor:'#c4c4c4', bodyColor:'#c4c4c4'},\n"; $rstr .= "      height:     305,\n"; $rstr .= "      width:      550\n"; $rstr .= "  });\n"; $rstr .= "}\n"; $rstr .= "</script>"; $rstr .= "</head>"; $rstr .= "<body $onloadmsg>"; $xF8598X1F = $rstr;  $t = htmlspecialchars($arArticle['title']); $xF8598X1F .= '<pre><table id="preview-table">'; $xF8598X1F .= '<tr><td class="preview-cmd-td"><div class="preview-cmd">Title:</div></td><td><div class="preview-value">'.$t.'</div></td></tr>';  $noneMsg = '<span style="color:#800080;font-weight:bold">NONE</span>';  if($arArticle['wordpressslug'] == 'x') { $noU = '<span style="color:#800080;font-weight:bold">NONE (WP default): </span>'; $previewVal = strip_tags($arArticle['title']); }else{ $noU = ''; $previewVal = $arArticle['wordpressslug']; }  $previewVal = str_replace(' ', '-', $previewVal); $previewVal = trim(preg_replace('/[^a-z0-9-_]+/', '', strtolower($previewVal)),' -'); $previewVal = preg_replace('/-+/', '-', $previewVal); $xF8598X1F .= '<tr><td class="preview-cmd-td"><div class="preview-cmd">Slug:</div></td><td><div class="preview-value">'.$noU.$previewVal.'</div></td></tr>';  $previewVal = ($arArticle['wordpressspin'] == 'x')? $noneMsg:htmlspecialchars($arArticle['wordpressspin']); $xF8598X1F .= '<tr><td class="preview-cmd-td"><div class="preview-cmd">Spin:</div></td><td><div class="preview-value">'.$previewVal.'</div></td></tr>';  $previewVal = ($arArticle['wordpresstags'] == 'x')? $noneMsg:htmlspecialchars($arArticle['wordpresstags']); $xF8598X1F .= '<tr><td class="preview-cmd-td"><div class="preview-cmd">Tags:</div></td><td><div class="preview-value">'.$previewVal.'</div></td></tr>';  $previewVal = ($arArticle['wordpressparent'] == 'x')? $noneMsg:htmlspecialchars($arArticle['wordpressparent']); $xF8598X1F .= '<tr><td class="preview-cmd-td"><div class="preview-cmd">Parent:</div></td><td><div class="preview-value">'.$previewVal.'</div></td></tr>';  $previewVal = ($arArticle['wordpresstemplate'] == 'x')? $noneMsg:htmlspecialchars($arArticle['wordpresstemplate']); $xF8598X1F .= '<tr><td class="preview-cmd-td"><div class="preview-cmd">Template:</div></td><td><div class="preview-value">'.$previewVal.'</div></td></tr>';  $previewVal = ($arArticle['wordpresscategory'] == 'x')? $noneMsg:htmlspecialchars($arArticle['wordpresscategory']); $xF8598X1F .= '<tr><td class="preview-cmd-td"><div class="preview-cmd">Category:</div></td><td><div class="preview-value">'.$previewVal.'</div></td></tr>';  $previewVal = ($arArticle['metakeywords'] == 'x')? $noneMsg:htmlspecialchars($arArticle['metakeywords']); $xF8598X1F .= '<tr><td class="preview-cmd-td"><div class="preview-cmd">Meta Keywords:</div></td><td><div class="preview-value">'.$previewVal.'</div></td></tr>';  $previewVal = ($arArticle['metadescription'] == 'x')? $noneMsg:htmlspecialchars($arArticle['metadescription']); $xF8598X1F .= '<tr><td class="preview-cmd-td"><div class="preview-cmd">Meta Description:</div></td><td><div class="preview-value">'.$previewVal.'</div></td></tr>';  $xF8598X1F .= '</table></pre><div id="preview-divider">'.$adivMsg.'</div>'; $xF8598X1F .= '<div style="font-family:Verdana,Arial,Helvetica,sans-serif;font-size:12.8px">'.$arArticle['content'].'</div>'; $xF8598X1F .= '</body></html>'; header('Content-type: text/html'); $x6614XE05 = fopen($tmpfile, 'w'); if(!$x6614XE05) { echo 'open error. file='.$tmpfile; exit(); } fwrite($x6614XE05,$xF8598X1F); fclose($x6614XE05); if($tag == 'respin') { echo mt_rand(); exit(); } echo $y2c53aXEa; exit(); }     function _silotableCback($m) { list($cols, $sty, $lcase, $a, $b, $c, $d) = explode(',', $m[1]); $xstr = 'Example Text'; if($lcase == 'u') $xstr = strtoupper($xstr); else if( ($lcase == 'l') || ($lcase == 'a') ) $xstr = strtolower($xstr);  $tstr = "<table class='$sty'><tr>";  for($x=0;$x<$cols;$x++) { $tstr .= "<td><a href='#'>$xstr</a></td>"; } $tstr .= "</tr><tr>"; for($x=0;$x<$cols;$x++) { $tstr .= "<td><a href='#'>$xstr</a></td>"; }  $tstr .= "</tr></table>"; return $tstr; }  function _youtubeCback($m) { $hp   = 0;  $wp   = 0;  $j = json_decode($m[1], true); if( isset($j['hp']) ) $hp = $j['hp']; if( isset($j['wp']) ) $wp = $j['wp']; $hp = ($hp == 1)? '%' : 'px'; $wp = ($wp == 1)? '%' : 'px'; return "<div style=\"height:{$j['h']}{$hp}; width:{$j['w']}{$wp}; background-color:#c4c4c4;border:1px solid black \"><p style=\"text-align:center\">YouTube video placeholder</p></div>"; } function _yelpCback($m) { $j = json_decode($m[1], true); $ht = $j['limit'] * 80; return "<div style=\"height:{$ht}px;width:180px;white-space:nowrap; background-color:#c4c4c4;border:1px solid black \"><p style=\"text-align:center\">Yelp placeholder</p></div>"; }   function xece7fXCC() { global $xF8598X1F; if(preg_match_all('/({|})/',$xF8598X1F,$m,PREG_PATTERN_ORDER) == 0) return 0; $x=0; foreach($m[1] as $b) { if($b == '{') $x++; else $x--; if($x < 0) return -1; } return $x; }   function _set_xospinCback($m) { if( strpos($m[0], '{') === false) return $m[0]; else return "[xospin]$m[0][/xospin]"; }   function _fix_nospinCback($m) { global $spin_stat, $xspin_stat;  switch(strtolower($m[1])) { case '[xospin]': if($spin_stat == SPIN_NO) { $xspin_stat = ''; return '';        } else { $xspin_stat = '[/nospin]'; return '[nospin]'; } break;  case '[/xospin]': return $xspin_stat;  case '[nospin]': case '[/dospin]': if($spin_stat == SPIN_NO) return '';  $spin_stat = SPIN_NO; return '[nospin]';  case '[/nospin]': case '[dospin]': if($spin_stat == SPIN_NONE) return '';  $spin_stat = SPIN_NONE; return '[/nospin]'; } }   function restoreBraces() { global $xF8598X1F; $s = array("\vL","\vP","\vR"); $r = array('{','|','}'); $xF8598X1F = str_replace($s,$r,$xF8598X1F); }   function xDe9159X6() { global $xF8598X1F; $xefC176X6 = array('{','|','}'); $x22a166Xb= array("\vL","\vP","\vR"); while(preg_match('#^(.*)\[\s*NoSpin\s*\](.*)\[\s*/NoSpin\s*\](.*)#si', $xF8598X1F, $m) == 1) { $s = str_replace($xefC176X6,$x22a166Xb,$m[2]); $xF8598X1F = $m[1].$s.$m[3]; } }  function doSpin() { while(aSpin()) {} return; }  function aSpin() { global $xF8598X1F; preg_match('#\{(.+?)\}#is',$xF8598X1F,$m); if(empty($m)) return false; $t = $m[1]; if(strpos($t,'{')!==false){ $t = substr($t, strrpos($t,'{') + 1); } $parts = explode("|", $t); $r = str_replace('$','\\$',$parts[array_rand($parts)]); $xF8598X1F = preg_replace("+\{".preg_quote($t)."\}+is", $r, $xF8598X1F, 1); return true; }   function parseArticle($xx85188XA) { $ar = array( 'status'=>'ok', 'title'=>'', 'wordpressslug'=>'x', 'wordpressspin'=>'x', 'wordpresstags'=>'x', 'wordpressparent'=>'x', 'wordpresstemplate'=>'x', 'wordpresscategory'=>'x', 'metakeywords'=>'x', 'metadescription'=>'x', 'content'=>'' ); $s = array('<br />','<br>'); $r = array("\v","\v"); $xx85188XA = trim(str_replace($s,$r,$xx85188XA));  $pos = strpos($xx85188XA,"\v"); if(($pos === false)||( substr($xx85188XA,0,1)=='[')) { $ar['status'] = 'notitle'; return $ar; } $t = substr($xx85188XA,0,$pos); $ar['title'] = $t; if($t != strip_tags($t)) { $ar['status'] = 'htmltags'; return $ar; } $pos1 = strpos($t,"&nbsp;"); if($pos1 !== false) { $ar['status'] = 'nbsp'; return $ar; }  $bHasIntr = false; $patt = '/\[\s*(WordpressUrl|WordpressSlug|WordpressSpin|WordpressTags|WordpressParent|WordpressTemplate|WordpressCategory|MetaKeywords|MetaDescription)\s+([^\]]+)\s*\]/si'; while(preg_match($patt, $xx85188XA, $m, PREG_OFFSET_CAPTURE, $pos) == 1) { $k = strtolower($m[1][0]); if($k == 'wordpressurl') { $ar['status'] = 'wpurl'; return $ar; } $ar[$k] = trim($m[2][0]); $pos = $m[2][1];     $bHasIntr = true; } if($bHasIntr) $pos = strpos($xx85188XA, ']', $pos); $xx85188XA = trim(substr($xx85188XA, $pos+1)); $ar['content'] = str_replace("\v",'<br />',$xx85188XA); return $ar; }   function do404() { $assetFolder = $_GET['assetFolder']; $scanType = $_GET['scanType']; $xAC063X21 = array('status'=>'nofile', 'scanType'=>$scanType, 'assetFolder'=>$assetFolder); $assetFlen = strlen($assetFolder);  $order = array( 'script' => 'ascript', 'link' => 'blink', 'img' => 'cimg', 'a' => 'da');  $slashok = 0; if($scanType == 'assf') $slashok = 1; if($scanType == 'extf') $slashok = 1;   $ps = 'script|link|img|a';  $patt = "/(<($ps)[^>]+(?:href|src)=\")(?!http|mailto:|!mpcfolder!|javascript:|#|\\/#)([^\"]+)/i";  $outstr = ""; if(isset($_POST['DATA64'])) { $edstr = base64_decode( str_replace( array('-','_','.'),array('+','/','='), $_POST['DATA64'] ) ); if(preg_match_all($patt, $edstr, $m, PREG_OFFSET_CAPTURE) > 0) { $xAE0118X8 = count($m[3]); for($x=0;$x<$xAE0118X8;$x++) { $tag = $order[strtolower($m[2][$x][0])]; $xx85188XA = $m[3][$x][0]; if( ($xx85188XA[0] == '/') && ($xx85188XA[1] == '/') ) continue;  if( ($slashok == 0) && ($xx85188XA[0] == '/') ) continue; if( ($scanType == 'assf') && (substr($xx85188XA, 0, $assetFlen) == $assetFolder) ) continue;  $pos = $m[3][$x][1]; $outstr .= "$tag\t$xx85188XA\t$pos\n"; } }    } if($outstr != "") { $xAC063X21['status'] = 'yesfile'; if(! is_dir('tmp')) mkdir('tmp', 0777); file_put_contents('tmp/tmp.404.txt', $outstr); file_put_contents('tmp/tmp.edstr.txt', $edstr);  } echo json_encode($xAC063X21); exit(); }   function isNoSpinWarning() { global $xF8598X1F;  if(preg_match_all('/\{[^\|]*?\}/',$xF8598X1F,$m) > 0) { file_put_contents('ns.txt', implode("\n", $m[0])); return true; } return false; }   function statCanonical() { global $xF8598X1F;  $xC6E168XE = 0; if(preg_match('/<link.*?rel="canonical".*?>/i',$xF8598X1F,$m) == 1) { if(preg_match('/href="(.*)"/i', $m[0], $mm) == 1) { if( strpos($mm[1], '#') === false) $xC6E168XE += 1; } } if(preg_match('/<link.*?rel="shortlink".*?>/i',$xF8598X1F,$m) == 1) { if(preg_match('/href="(.*)"/i', $m[0], $mm) == 1) { if( strpos($mm[1], '#') === false) $xC6E168XE += 2; } } if(preg_match('/<.*?property="og:url".*?>/i', $xF8598X1F, $m) == 1) { if(preg_match('/content="(.*)"/i',$m[0], $mm) == 1) { if( strpos($mm[1], '#') === false) $xC6E168XE += 4; } } return $xC6E168XE; }   function xC2E8eXa9($x68F95XEB, &$xx85188XA) { $x68F95XEB = str_replace(' ','',$x68F95XEB); if($x68F95XEB != ',,,,,,,,') { $ar = explode(',', $x68F95XEB); array_unshift($ar,'url!'); for($x=0;$x<10;$x++) { $xBcX87XFC = trim($ar[$x]); if($xBcX87XFC != "") { $x0Ax56XAx[] = '/(#|#\+|#-|\~)'.$xBcX87XFC.'(#|:s#|:l#|:u#|:t#|:h#|:w#)/i'; $x4335dXeA[] = '$1var'.$x.'${2}'; } } $xx85188XA = preg_replace($x0Ax56XAx,$x4335dXeA,$xx85188XA); }  $xx85188XA = preg_replace_callback('/#([+-~]?)var(\d)(#|:s#|:l#|:u#|:t#|:h#|:w#)/i', '_var2digits', $xx85188XA); }  function _var2digits($m) { if($m[1] == "") $m[1] = '=';   if($m[3] == '#') $m[3] = ':a#'; return '#'.'var'.$m[1].'0'.$m[2].$m[3]; }   function getVarLabels() { $s = pv_snap_get_contents('cp_txVar1'); for($x=2;$x<10;$x++) { $s .= ',' . pv_snap_get_contents("cp_txVar$x"); } return $s; }   function pv_snap_get_contents($fname) { if(!file_exists("snap/$fname")) return ""; return file_get_contents("snap/$fname"); }   function ycAc83X77(&$xx85188XA) { $xx85188XA = preg_replace_callback('/#var(\+|\-|\=|\~)0(\d)(:a#|:s#|:l#|:u#|:t#|:h#|:w#)/i', 'varCallback', $xx85188XA); }   function varCallback($m) { global $x3ED3cXF7, $Project;  $v = $x3ED3cXF7[x0dE1fXCF+$m[2]];  switch($m[3]) { case ':a#': return $v; break; case ':s#': return ucfirst(strtolower($v)); break; case ':l#': return strtolower($v); break; case ':u#': return strtoupper($v); break; case ':t#': return ucwords(strtolower($v)); break; case ':h#': if($Project->lowurl_yn == 'yes') $v = strtolower($v); return str_replace(' ','-',$v); break; case ':w#': $v = ucwords(strtolower($v)); return str_replace(' ','+',$v); break; default: return $m[0]; break; } }  function DEBUG($msg) { $xcf35XCFE = fopen("DEBUG1","ab"); fwrite($xcf35XCFE,$msg,strlen($msg)); fwrite($xcf35XCFE,"\n",1); fclose($xcf35XCFE); }  function ARDEBUG($msg,$xAC063X21,$file = './DEBUG1') { $msg .= "\n".print_r($xAC063X21,true); $xcf35XCFE = fopen($file,'ab'); fwrite($xcf35XCFE,$msg,strlen($msg)); fwrite($xcf35XCFE,"\n",1); fclose($xcf35XCFE); }  ?>