<?php require_once "$theAuxDir/spin.php"; require_once "$theAuxDir/class_dbase.php";  define('xebF1dXC9',    1); define('x0dE1fXCF',     3); define('y4C544X3F',    1); define('y6Fe46X4G',    2); define('y0c547X4B',    3);  $xX2d39X1X;$Project;$yD6G3eXaE; $xeCdfdXf7;$yAxB37X4A; $xx213dXa3;$x6Fe46X4G; $xEG154XF3;$x0c547X4B;$xBFb197Xx;$y6C133X50; $xEXd53X18;$x3ED3cXF7;$x6b643Xc0; $siloDepth;$x9C64aX66;  function xGCea2XXE($caller, $y49C15XDe, $x3GGccX6b, $exlist, $rad_rss) { global $theAuxPath, $yD6G3eXaE, $y61C3fXA1, $xdFG6cXB9; global $xX2d39X1X,$Project,$x3ED3cXF7,$x9C64aX66,$xX944cXce; global $theAuxDir,$yAxB37X4A,$xeCdfdXf7,$xEXd53X18; global $x6Fe46X4G,$xx213dXa3, $vFolder; global $x07A18bXA,$x72Ed0Xb1,$y6C133X50,$buildLst; global $x9fEfcX8f,$siloDepth, $x9Ba196Xc, $x9FF198XE, $bluelimit; global $iAuto, $bMin, $bMax; $yD6G3eXaE = (substr($x3GGccX6b, 0, 3) == 'xml'); $x72Ed0Xb1 = ""; if(file_exists("$theAuxDir/cancel")) unlink("$theAuxDir/cancel"); if(file_exists("$theAuxDir/warning")) unlink("$theAuxDir/warning"); if(file_exists("$theAuxDir/error")) unlink("$theAuxDir/error"); if(file_exists("$theAuxDir/xzipcode")) unlink("$theAuxDir/xzipcode");  if(file_exists("$theAuxDir/rss.php")) unlink("$theAuxDir/rss.php"); if(file_exists("$theAuxDir/rssi.php")) unlink("$theAuxDir/rssi.php");  if(substr($x3GGccX6b, 0, 4) == 'xml_') { if(file_exists("$theAuxDir/cloudxml"))  x60C9cX1b("$theAuxDir/cloudxml"); mkdir("$theAuxDir/cloudxml", 0777, true); }  $Project = json_decode(file_get_contents("$theAuxDir/jsettings"));  if(x46G10dX8()) { $x72Ed0Xb1 = json_encode(array( 'status'=>'error', 'caption'=>'Blueprint error', 'msg'=>"Duplicates were found in Path list boxes.<br />Please open the Project utility and click 'Clean Project'.", 'h'=>'133', 'w'=>'505' )); return; }  yE0F82XFb();  $x9C64aX66 = array(); $xX944cXce = array();  $x6Fe46X4G = array_fill(0,5,0); $y61C3fXA1 = array_fill(0,6,0); $siloDepth = 0; for($x=1; $x<6; $x++) { $xF0F1beXf = x0dD34XaX($x,$count); if($xF0F1beXf == -1) { $x72Ed0Xb1 = json_encode(array( 'status'=>'error', 'caption'=>'Blueprint error', 'msg'=>"Each Path listbox must contain either ALL or NO Silo entries:<br /><b>Path $x</b>", 'h'=>'133', 'w'=>'500' )); return; } if($xF0F1beXf == -2) { $x72Ed0Xb1 = json_encode(array( 'status'=>'error', 'caption'=>'Blueprint error', 'msg'=>"Cannot use relative addressing (../) in Path list boxes:<br /><b>Path $x</b>", 'h'=>'133', 'w'=>'500' )); return; }  $xCCc55X5A[$x-1] = $count; if($xF0F1beXf == 0) continue;    if( ($x3GGccX6b == 'text') && ($x > 1) ) { $x72Ed0Xb1 = json_encode(array( 'status'=>'error', 'caption'=>'Blueprint error', 'msg'=>"Text article (Wordpress) projects can only use Path 1 for Silos.", 'h'=>'115', 'w'=>'500' )); return; }  $x9C64aX66['path'][] = $x;  $siloDepth++;   $x6Fe46X4G[$x-1] = $siloDepth; $y61C3fXA1[$siloDepth-1] = $x; }  for($x=1; $x<10; $x++) { x9c7107X7($x,$beg,$end,$total); $xEXd53X18['current'.$x] = $beg;   $xEXd53X18['beg'.$x]     = $beg;   $xEXd53X18['end'.$x]     = $end;   $xEXd53X18['total'.$x]   = $total; }  x43x148XE();  if($xdFG6cXB9) { $dbBlue = new dbase($theAuxPath, 'unbuild.db'); $dbBlue->openWrite(0, 0, 0); } else if($yD6G3eXaE) { $dbBlue = new dbase($theAuxPath, 'xml.db'); $dbBlue->openWrite(0, 0, 0); } else { for($x=9;$x>0;$x--) { if( is_file("$theAuxDir/snap/cp_txVar".$x) && (filesize("$theAuxDir/snap/cp_txVar".$x) > 0) ) break; if( is_file("$theAuxDir/snap/cp_taVar".$x) && (filesize("$theAuxDir/snap/cp_taVar".$x) > 0) ) break; } $yb1d40XxF = $x+1;  $n1 = ($caller == 'diaBlue')? 'b' : 'r'; $n2 = ($x3GGccX6b == 'html')? 'h' : 't'; $dbBlue = new dbase($theAuxPath, "$n1$n2.db"); $dbBlue->openWrite($yb1d40XxF, ($Project->lowurl_yn == 'yes')? 1 : 0, $siloDepth); }  $yAxB37X4A = 0; $yBa741X2A = 100/$x9fEfcX8f; $xF53151Xb = 0; $files_done = 0; $ybeF42Xd7 = 0; $y6C133X50 = array_fill(0,5,'*'); if($rad_rss != 'none') { }  $bVhtmlOk = false; if($buildLst == 'V') $bVhtmlOk = testHtmlPhp();  $FBP = fopen("$theAuxDir/permu.php", 'r'); while( ($x6C133X50 = fgets($FBP, 255)) ) { if(isCancel()) { $x72Ed0Xb1 = '{"status":"cancel"}'; break; }  if($x72Ed0Xb1 != "") break;  $pc_new = floor($xF53151Xb * $yBa741X2A); if($pc_new != $ybeF42Xd7) { $ybeF42Xd7 = $pc_new; xfdd2aX04($ybeF42Xd7); } $xX2d39X1X = array(); $ac = trim($x6C133X50); if($ac == "") continue; xBae182XB($ac, $x3GGccX6b, $y49C15XDe); foreach($xX2d39X1X as $line) {  $ma = explode("\t", $line, 5);  $ma[0] .= "\t"; $ma[2] = "\t".$ma[2];  $src  = $ma[1]; $psd  = $ma[0].$ma[1].$ma[2]; $var0 = $ma[3]; $var9 = "\t".$ma[4]; list($p, $s, $d) = explode("\t",str_replace('//','/',$psd)); $y6ed17X4G = ""; $p1 = $ma[0]; $si = (substr($ma[2], -2) == '_@')? true : false; $silo_index = 0; if($si) $silo_index = substr_count($ma[0], '//'); if($x3GGccX6b == 'text') { $r = "$theAuxDir/article/"; if($siloDepth == 1) { if(si) { preg_match('#^(.+?)//#', $ma[0], $mm); $p1 = $mm[1].'@'; $y6ed17X4G = yaff84XxX($mm[1]); $d = $p1; } else { preg_match('#^(.+?)//(.+?)\t#', $ma[0], $mm); $p1 = $mm[1]; $d = str_replace('/','~', $mm[1].'//'.$mm[2].'/'.$d); } } else { $d = str_replace('/','~',"$p/$d"); } x8fF178X3($line);  $wpi = array(); x5b1dcX8A($wpi); $wpi['source'] = $src; $wpi['path1'] = trim($p1); if($y6ed17X4G != "") $wpi['slug'] = $y6ed17X4G;  $dbBlue->writeWpItem( json_encode($wpi) );  if($siloDepth == 1) { $var0 = yaff84XxX($p1) . '/' . yaff84XxX($wpi['slug']); } else { if($y49C15XDe == 1) { $var0 = ( empty($wpi['category']) )? yaff84XxX($wpi['slug']) : yaff84XxX($wpi['category']).'/'.yaff84XxX($wpi['slug']); } else { $var0 = ( empty($wpi['parent']) )? yaff84XxX($wpi['slug']) : yaff84XxX($wpi['parent']).'/'.yaff84XxX($wpi['slug']); } } } else { $r = yE48a3XfC(); $d = str_replace(' ', '-', $var0); }  if( ($yD6G3eXaE) || ($xdFG6cXB9) ) { $dbBlue->writeDest($d); $files_done++; continue; }  $sDestBp = "$psd"; if( ($caller == 'diaBlue') && ($x3GGccX6b == 'html') ) $r = 'tmp/'; $sDest = "$r$d"; if( ($caller == 'diaBuild') && ($buildLst == 'C') && ($x3GGccX6b == 'html') ) { if(preg_match('/\.php$/i', $d) == 1) { $x72Ed0Xb1 = json_encode(array( 'status'=>'error', 'caption'=>'Cloud filetype error', 'msg'=>"Cannot upload PHP files to Amazon S3.<br />$d", 'h'=>'133', 'w'=>'505' )); fclose($FBP); $dbBlue->close(true); return $files_done; } } else if( ($buildLst == 'V') && (! $bVhtmlOk) ) { if(preg_match('/\.php$/i', $d) != 1) { $x72Ed0Xb1 = json_encode(array( 'status'=>'error', 'caption'=>'Vpage filename error', 'msg'=>'Vpages require <b>php</b> extensions. <a href="http://masspagecreator.com/ck/errpage.php?cmd=vphp" target="_blank">More info</a>', 'h'=>'117', 'w'=>'505' )); fclose($FBP); $dbBlue->close(true); return $files_done; } }  if($x3GGccX6b != 'text') $iFilter = y9ad1eXdD; else $iFilter = ($wpi['spin'] == -3)? yfcf1cXxf : y5dXc9XfD; if(($exlist != "") && xx7B10cXc($s)) $iFilter = yea919XDx; if( ($iFilter == y9ad1eXdD) && ($r == "") ) $iFilter = ydBd45X61; $varzId = $dbBlue->writeVarsetRow("$var0$var9"); if($buildLst == 'V') { $seedas = mt_rand(); if($seedas == 0) $seedas = 1; $nextas = 0; $stepas = 0; if($iAuto > 0) { if($bMax < $bMin) { $xF0F1beXf = $bMin; $bMin = $bMax; $bMax = $xF0F1beXf; } $stepas = ($bMin == $bMax)? $bMin : mt_rand($bMin, $bMax); $stepas *= $iAuto; $nextas = time() + $stepas; } $dbBlue->writePageRow($s, $sDest, $files_done+1, $files_done, $files_done+2, $varzId, $iFilter, $sDestBp, $silo_index, $seedas, $nextas, $stepas, $vFolder); } else { $dbBlue->writePageRow($s, $sDest, $files_done+1, $files_done, $files_done+2, $varzId, $iFilter, $sDestBp, $silo_index); }   $files_done++; }   $xF53151Xb++; if(($xeCdfdXf7 > 0) && ($yAxB37X4A == $xeCdfdXf7)) break; if(($bluelimit != 0) && ($yAxB37X4A >= $bluelimit)) break; } fclose($FBP);  if($rad_rss != 'none') {  }  if( ($yD6G3eXaE) || ($xdFG6cXB9) ) { $dbBlue->close(true); return $files_done; }  if( ($siloDepth == 0) || ($files_done == 1) ) { $dbBlue->doQuery("UPDATE page SET prev_var='$files_done' WHERE id='1'");  $dbBlue->doQuery("UPDATE page SET next_var='1' WHERE id='$files_done'");  $dbBlue->close(true); return $files_done; }   $x2C048X4e = array(); xxe8a4XF8($x2C048X4e); for($x=1;$x<=$files_done;$x++) { list($prev,$next) = explode("\t",$x2C048X4e[$x-1]); $prev++; $next++; $dbBlue->doQuery("UPDATE page SET prev_var='$prev', next_var='$next' WHERE id='$x'");  }  $dbBlue->close(true); return $files_done; }   function yE48a3XfC() { global $theAuxDir, $buildLst;  if($buildLst == 'L') return '../';  if($buildLst == 'V') return '../';  if($buildLst == 'T') return '';     if($buildLst == 'C') return "$theAuxDir/staging/"; }    function xBae182XB($x4A018aXb, $x3GGccX6b, $y49C15XDe) { global $x72Ed0Xb1, $x9xb9dX1A, $x84e4eX9A, $x9C64aX66; global $xX944cXce,$siloDepth,$y6C133X50; global $xx5C14aXA,$x4c014fXC,$xAxB37X4A,$yAxB37X4A; global $y61C3fXA1;  x2FF147X0($x4A018aXb, $xx5C14aXA, $x4c014fXC, $xAxB37X4A, $xbc3150X3);  if($siloDepth > 0) { $yGac35XBx = explode('//', $xbc3150X3);  for($xXdb17fXE=1; $xXdb17fXE <= $siloDepth; $xXdb17fXE++) { $s1=$s2=''; for($x=0; $x<$xXdb17fXE; $x++) { $s1 .= $yGac35XBx[$x]; $s2 .= $y6C133X50[$x]; } if($s1 == $s2) continue;  for($x=0; $x<$xXdb17fXE; $x++) { $y6C133X50[$x] = $yGac35XBx[$x]; } for($x=$xXdb17fXE; $x<5; $x++) { $y6C133X50[$x] = '*'; }  $xdB78cXdE = count($x84e4eX9A['i_fname']); if( ($xdB78cXdE > 0) && ($x3GGccX6b == 'text') && ($y49C15XDe == 1) ) { $x72Ed0Xb1 = json_encode(array( 'status'=>'error', 'caption'=>'Blueprint error', 'msg'=>'Wordpress <b>POST</b> projects cannot use Silo Index files', 'h'=>'133', 'w'=>'500' )); return; }  $x9xb9dX1A = 0; for($x=0;$x<$xdB78cXdE;$x++) { if($x84e4eX9A['i_silolevel'][$x] == $xXdb17fXE) { $xDX2152X0 = '#^(.+?//){'.$xXdb17fXE.'}#'; preg_match($xDX2152X0,$xbc3150X3,$m); $x59b17dXB = $m[0]; $xe2C172XX = x8d92fXE0($x84e4eX9A['i_fname'][$x], $x84e4eX9A['i_formula'][$x], $x84e4eX9A['i_dest'][$x], $x59b17dXB, '_@', true, $y61C3fXA1[$xXdb17fXE-1]); if($x72Ed0Xb1 != "") return;  if($xe2C172XX == "") continue;  $x9C64aX66['index_'.$xXdb17fXE][] = $yAxB37X4A-1; } }  }  } $x9xb9dX1A = 0; $defnum = -1; $xdB78cXdE = count($x84e4eX9A['fname']); for($x=0;$x<$xdB78cXdE;$x++) { $xF0F1beXf = substr($x84e4eX9A['dest'][$x], -2); if( ($xF0F1beXf == '_(') || ($xF0F1beXf == '_)') ) { $defnum = $x; continue; }  $xe2C172XX = x8d92fXE0($x84e4eX9A['fname'][$x], $x84e4eX9A['formula'][$x], $x84e4eX9A['dest'][$x]); if($x72Ed0Xb1 != "") return;  if($xe2C172XX == "") continue;  x13315fXX($xe2C172XX, $yAxB37X4A-1); }  if(! empty($x84e4eX9A['group']['group:']['end']) ) { $x = $x84e4eX9A['group']['group:']['index']; $xe2C172XX = x8d92fXE0($x84e4eX9A['group']['group:']['fname'][$x], '*', $x84e4eX9A['group']['group:']['dest'][$x]); if($x72Ed0Xb1 != "") return; $x++; if($x == $x84e4eX9A['group']['group:']['end']) $x = 0; $x84e4eX9A['group']['group:']['index'] = $x; x13315fXX($xe2C172XX, $yAxB37X4A-1); }  $gk = array_keys($x84e4eX9A['group']); foreach($gk as $gar) { if($gar == 'group:') continue;  $x = $x84e4eX9A['group'][$gar]['index']; $xe2C172XX = x8d92fXE0($x84e4eX9A['group'][$gar]['fname'][$x], '['.substr($gar,6).']', $x84e4eX9A['group'][$gar]['dest'][$x]); if($x72Ed0Xb1 != "") return; if($xe2C172XX == "") continue; $x++; if($x == $x84e4eX9A['group'][$gar]['end']) $x = 0; $x84e4eX9A['group'][$gar]['index'] = $x; x13315fXX($xe2C172XX, $yAxB37X4A-1); }  if($x9xb9dX1A == 0) { if($defnum != -1) { $xe2C172XX = x8d92fXE0($x84e4eX9A['fname'][$defnum], $x84e4eX9A['formula'][$defnum], $x84e4eX9A['dest'][$defnum]); if($x72Ed0Xb1 != "") return; x13315fXX($xe2C172XX, $yAxB37X4A-1); return; } $xx85188XA = str_replace('//','/',$xx5C14aXA); $x72Ed0Xb1 = json_encode(array( 'status'=>'error', 'caption'=>'Blueprint error', 'msg'=> "Check Source formulas. No page written for path:<br />$xx85188XA", 'h'=>'133', 'w'=>'500' )); } }   function x8d92fXE0($xB5a170X1, $x71197X2e, $x1DB96Xx4, $x59b17dXB = '', $x152afXD0 = '', $x0ED1b5Xc = false, $maxPath = 5) { global $xEG154XF3, $yD6G3eXaE, $xdFG6cXB9; global $xX2d39X1X,$x9xb9dX1A,$xEXd53X18; global $xeCdfdXf7,$yAxB37X4A,$x72Ed0Xb1,$xa532XF58,$x2f0c0XG1; global $siloDepth; global $xx5C14aXA,$x4c014fXC;  $xF0F1beXf = substr($x1DB96Xx4,-2); if( ($xF0F1beXf == '_#') || ($xF0F1beXf == '_(') || ($xF0F1beXf == '_)') ) { $x152afXD0 = $xF0F1beXf; $x1DB96Xx4 = substr($x1DB96Xx4,0,-2); } if($x59b17dXB == '') { $x302140Xa = $xx5C14aXA; $xaB4141Xd = strtolower($x302140Xa); $x9db142Xd = $x4c014fXC; } else { $x302140Xa = str_replace(' ','-',$x59b17dXB); $x9db142Xd = $x59b17dXB; $xaB4141Xd = trim(strtolower($x302140Xa),'/'); }  if($x71197X2e != '*') { $xEG154XF3['k0'][0] = $x71197X2e.'ok'; if(xb42c6X0d(0, $xaB4141Xd, '* ' ,$x9db142Xd , 0, 5) != 'ok') return ""; }  $xA6411cXE = $x302140Xa;  if( (($x152afXD0 == '_#') || ($x152afXD0 == '_)')) && (substr($xA6411cXE,-2) == '//')) { $x72Ed0Xb1 = json_encode(array( 'status'=>'error', 'caption'=>'Blueprint error', 'msg'=>"Cannot use 'File Extension' when parent folder is a silo:<br />$xA6411cXE", 'h'=>'133', 'w'=>'500' )); return; }  if($yD6G3eXaE || $xdFG6cXB9) $xA6411cXE .= "\tx"; else $xA6411cXE .= "\t".$xB5a170X1;  $xA6411cXE .= "\t".$x1DB96Xx4.$x152afXD0; $x0Cf17eXe = ( ($x152afXD0 == '_#') || ($x152afXD0 == '_)') )? '' : '/'; $x4E914bXB = trim(str_replace('//','/',$x302140Xa),'/').$x0Cf17eXe.$x1DB96Xx4;           $x1dF14cXD = trim(str_replace('//','/',$x9db142Xd),'/').$x0Cf17eXe.$x1DB96Xx4; if(substr($x302140Xa,-2) != '//') $x302140Xa = trim($x302140Xa,'/').$x0Cf17eXe; $xe2C172XX = $x302140Xa.$x1DB96Xx4;  if(($xa532XF58 == 'a8d92fXE0')&&($x2f0c0XG1 == 'html')) { $xF0F1beXf = x9Ea10fX6($x4E914bXB); if($xF0F1beXf != "") { $x72Ed0Xb1 = json_encode(array( 'status'=>'error', 'msg'=>"Cannot build into a protected directory:<br />$xF0F1beXf" )); return; } }  if($yD6G3eXaE || $xdFG6cXB9) { $x2EG11bX7 = "\t".$x1dF14cXD."\tx"; } else { for($x=1; $x<10; $x++) { $x03236XeE[$x-1] = xb42c6X0d($x, $xaB4141Xd, $x4E914bXB, $x1dF14cXD, 1, $maxPath); }  $x2EG11bX7 = "\t".$x1dF14cXD;  for($x=0;$x<9;$x++) { $x2EG11bX7 .= "\t" . $x03236XeE[$x]; } } $xX2d39X1X[] = "$xA6411cXE$x2EG11bX7"; $yAxB37X4A++; $x9xb9dX1A++; if( $x0ED1b5Xc && ($x9xb9dX1A > 1)) { $x72Ed0Xb1 = json_encode(array( 'status'=>'error', 'caption'=>'Blueprint error', 'msg'=>"Check Source formulas. Only 1 INDEX file allowed per SILO:<br /><b>$x59b17dXB</b>", 'h'=>'133', 'w'=>'500' )); return; }  if(($xa532XF58 == 'a8d92fXE0')&&($x2f0c0XG1 == 'text')) { if($x9xb9dX1A > 1) { $x72Ed0Xb1 = json_encode(array( 'status'=>'error', 'msg'=>"Check Source formulas. Multiple Text Articles would be written to:<br /><b>$xx5C14aXA</b>" )); } }  if($x59b17dXB == '') { for($x=1;$x<10;$x++) { if($xEXd53X18['total'.$x] == 0) continue; $b = $xEXd53X18['current'.$x] + 1; if($b > $xEXd53X18['end'.$x]) $b = $xEXd53X18['beg'.$x]; $xEXd53X18['current'.$x] = $b; } } return $xe2C172XX; }  $x4aA16fXd;  function xb42c6X0d($xd551aeXD, $x0AB14eX2, $x4E914bXB, $x1dF14cXD, $xCXEffXGD, $maxPath) { global $xEG154XF3, $xdFG6cXB9; global $xAxB37X4A, $x4aA16fXd, $xx213dXa3, $xEXd53X18;   $xed5c8X67 = $xEG154XF3['k'.$xd551aeXD][0]; $xed5c8X67 = trim($xed5c8X67); if($xed5c8X67 == "") return ' '; foreach($xEG154XF3['k'.$xd551aeXD] as $xed5c8X67)     { $xed5c8X67 = trim($xed5c8X67); if($xed5c8X67 == "") return ' '; if($xed5c8X67[0] != '[') { if($xCXEffXGD == 0) return $xed5c8X67; return $xEG154XF3['k'.$xd551aeXD][$xEXd53X18['current'.$xd551aeXD]]; }     if(preg_match('/^\[\s*(\w+)(.*)$/', $xed5c8X67, $m) == 1) { $x279128X2 = strtolower($m[1]); if(!empty($xx213dXa3[$x279128X2])) $xed5c8X67 = '[path'.$xx213dXa3[$x279128X2].$m[2]; } else if(preg_match('/^\[:(\w+):(.*)$/', $xed5c8X67, $m) == 1) { $x279128X2 = strtolower($m[1]); if(!empty($xx213dXa3[$x279128X2])) $xed5c8X67 = '[:path'.$xx213dXa3[$x279128X2].':'.$m[2]; } else if(preg_match('/^\[\(([\w ,!]+)\)\](.*)$/', $xed5c8X67, $m) == 1) { $x279128X2 = strtolower($m[1]);  switch( trim($m[2]) ) { case 'us_state_abbreviation': if(empty($xx213dXa3[$x279128X2])) return ' '; $pnum = $xx213dXa3[$x279128X2]; if($pnum > $maxPath) return ' '; $pval = trim($xAxB37X4A[$pnum-1],'/'); return yf5aa5X3C(strtolower($pval)); break;  case 'us_zipcode': list($s, $c, $m) = explode(',', $x279128X2); if(substr($s, -1) == '!') { $s = trim($s, '!'); } else { if(empty($xx213dXa3[$s])) return ' '; $s = $xx213dXa3[$s]; if($s > $maxPath) return ' '; $s = strtolower(trim($xAxB37X4A[$s-1],'/')); } if(empty($xx213dXa3[$c])) return ' '; $c = $xx213dXa3[$c]; if($c > $maxPath) return ' '; $c = strtolower(trim($xAxB37X4A[$c-1],'/'));  return us_zipcode($s, $c, $m); break;  default: return ' '; break; } }  $patt = '/^\[\s*path\s*([1-'.$maxPath.'])\s*\]/i'; if(preg_match($patt, $xed5c8X67, $m) == 1) return trim($xAxB37X4A[$m[1]-1],'/');  $patt = '/^\[\s*path\s*([1-'.$maxPath.'])\s*([=!~])\s*(.*)\s*\](.*)$/i'; if(preg_match($patt, $xed5c8X67, $m) == 1) { $xc0xe7X04 = trim($xAxB37X4A[$m[1]-1],'/'); $x55013dX2 = $m[2]; $xfF0135XX   = trim($m[3]); $xXdB86X29    = $m[4];  $xfF0135XX   = strtolower($xfF0135XX); $xc0xe7X04 = strtolower($xc0xe7X04);  switch($x55013dX2) { case '=': if($xc0xe7X04 == $xfF0135XX) return $xXdB86X29; break;  case '!': if($xc0xe7X04 != $xfF0135XX) return $xXdB86X29; break;  case '~': $pos = strpos($xc0xe7X04,$xfF0135XX); if($pos !== false) return $xXdB86X29; break; } }  if(preg_match('/^\[\s*([=!~])(?![=!~])(.*?)\](.*)$/i', $xed5c8X67, $m) == 1) { $xc0xe7X04 = strtolower(str_replace('//', '/', $x0AB14eX2)); $x55013dX2 = $m[1]; $xfF0135XX   = strtolower(trim($m[2])); $xXdB86X29    = $m[3];  switch($x55013dX2) { case '=': if($xc0xe7X04 == $xfF0135XX) return $xXdB86X29; break;  case '!': if($xc0xe7X04 != $xfF0135XX) return $xXdB86X29; break;  case '~': $pos = strpos($xc0xe7X04,$xfF0135XX); if($pos !== false) return $xXdB86X29; break; } }  if(preg_match('/^\[\s*(==|!!|~~)(.*?)\](.*)$/i', $xed5c8X67, $m) == 1) { $xc0xe7X04 = strtolower($x4E914bXB); $x55013dX2 = $m[1]; $xfF0135XX   = strtolower(trim($m[2])); $xXdB86X29    = $m[3];  switch($x55013dX2) { case '==': if($xc0xe7X04 == $xfF0135XX) return $xXdB86X29; break;  case '!!': if($xc0xe7X04 != $xfF0135XX) return $xXdB86X29; break;  case '~~': $pos = strpos($xc0xe7X04,$xfF0135XX); if($pos !== false) return $xXdB86X29; break; } }  $patt = '#^\[:path([1-'.$maxPath.']):/(.*)/(.*)\](.*)$#'; if(preg_match($patt, $xed5c8X67, $x4aA16fXd) == 1) { $xDX2152X0 = '/'.$x4aA16fXd[2].'/'.$x4aA16fXd[3]; $xaD613eXx = $x4aA16fXd[4]; $xA6D185X5 = trim($xAxB37X4A[$x4aA16fXd[1]-1],'/'); if(preg_match($xDX2152X0, $xA6D185X5, $x4aA16fXd) == 1) return preg_replace_callback('/\$(\d+)/','regxCallback',$xaD613eXx); }  if( ($maxPath == 5) && (preg_match('#^\[\s*/(.*)/\s*(.*)\s*\]\s*(.*)$#', $xed5c8X67, $x4aA16fXd) == 1) ) { $xDX2152X0 = '/'.$x4aA16fXd[1].'/'.$x4aA16fXd[2]; $xaD613eXx = $x4aA16fXd[3];  if(preg_match($xDX2152X0,$x1dF14cXD,$x4aA16fXd) == 1) return preg_replace_callback('/\$(\d+)/','regxCallback',$xaD613eXx); } }    return ' '; }  function regxCallback($m) { global $x4aA16fXd; return $x4aA16fXd[$m[1]]; }   function us_zipcode($s, $c, $m) { global $us_state2abb, $theAuxDir; global $db_zipcode, $ar_zipcode;  try { $xe4c186X4 = $s; if( strlen($s) > 2) $s = $us_state2abb[$s]; $xXcb167X9 = $db_zipcode->query("SELECT zip from x$s WHERE city='$c'");  if(! $xXcb167X9) { $ar_zipcode[$xe4c186X4]['xx'] = 1; return ' '; }  $row = $xXcb167X9->fetchArray(); if(empty($row[0])) { $ar_zipcode[$s][$c] = 1; return ' '; }  if(strlen($row[0]) < 6) return $row[0];   if($m == 0) return substr($row[0], 0, 5); else if($m == 1) return '{'.$row[0].'}';                else if($m == 2) return str_replace('|', ',', $row[0]); else return str_replace('|', ', ', $row[0]);            } catch(Exception $e) { return $e->getMessage(); } }   function x9c7107X7($n, &$beg, &$end, &$total) { global $xEG154XF3; $beg = 0; $end = 0; $total = 0; $xAE0118X8 = count($xEG154XF3['k'.$n]); if($xAE0118X8 == 0) return;  for($x=0;$x<$xAE0118X8;$x++) { if(substr($xEG154XF3['k'.$n][$x],0,1) == '[') continue; $beg = $x; $end = $x; $total++; break; } if($total == 0) return; for($x=$x+1;$x<$xAE0118X8;$x++) { if(substr($xEG154XF3['k'.$n][$x],0,1) == '[') break; $end++; $total++; } }   class SiloIterator extends RecursiveIteratorIterator { function __construct($ar) { parent::__construct(new _SiloIterator($ar)); } }   class _SiloIterator extends RecursiveArrayIterator { public function hasChildren() { $current = $this->current(); return !isset($current[0]); } }   function xxe8a4XF8(&$x2C048X4e) { global $x9C64aX66,$xX944cXce,$siloDepth;  for($x=1; $x <= $siloDepth; $x++) { if(empty($x9C64aX66['index_'.$x])) continue; $xdB78cXdE = count($x9C64aX66['index_'.$x]); if($xdB78cXdE == 1) { $x2C048X4e[$x9C64aX66['index_'.$x][0]] = $x9C64aX66['index_'.$x][0]."\t".$x9C64aX66['index_'.$x][0]; continue; } if($xdB78cXdE == 2) {  $x2C048X4e[$x9C64aX66['index_'.$x][0]] = $x9C64aX66['index_'.$x][1]."\t".$x9C64aX66['index_'.$x][1]; $x2C048X4e[$x9C64aX66['index_'.$x][1]] = $x9C64aX66['index_'.$x][0]."\t".$x9C64aX66['index_'.$x][0]; continue; } $x2C048X4e[$x9C64aX66['index_'.$x][0]] = $x9C64aX66['index_'.$x][$xdB78cXdE-1]."\t".$x9C64aX66['index_'.$x][1];  for($y=1;$y<$xdB78cXdE-1;$y++) { $x2C048X4e[$x9C64aX66['index_'.$x][$y]] = $x9C64aX66['index_'.$x][$y-1]."\t".$x9C64aX66['index_'.$x][$y+1]; }  $x2C048X4e[$x9C64aX66['index_'.$x][$xdB78cXdE-1]] = $x9C64aX66['index_'.$x][$xdB78cXdE-2]."\t".$x9C64aX66['index_'.$x][0]; }  foreach(new SiloIterator($xX944cXce, 0) as $xC87117Xd) { $xdB78cXdE = count($xC87117Xd); preg_match('/\^(\d+)$/', $xC87117Xd[0],$m); $n = $m[1];  if($xdB78cXdE == 1) { $x2C048X4e[$n] = $n."\t".$n; continue; }  if($xdB78cXdE == 2) { $x2C048X4e[$n] = ($n+1)."\t".($n+1); $x2C048X4e[$n+1] = $n."\t".$n; continue; }  $x2C048X4e[$n] = ($n-1+$xdB78cXdE)."\t".($n+1); for($x=1;$x<$xdB78cXdE-1;$x++) { $x2C048X4e[$n+$x] = ($n-1+$x)."\t".($n+1+$x); } $x2C048X4e[$n-1+$xdB78cXdE] = ($n-2+$xdB78cXdE)."\t".$n; } }   function y0GFd5Xf0($type) { global $theAuxDir;  if(! file_exists("$theAuxDir/tar")) { mkdir("$theAuxDir/tar", 0777, true); return; } $fname = "-$type.tar.gz"; $xAE0118X8 = strlen($fname);  $x861e4X7X = opendir("$theAuxDir/tar"); while (false !== ($xefXb5X80 = readdir($x861e4X7X))) { if ($xefXb5X80 == '.' || $xefXb5X80 == '..') continue; { if( substr($xefXb5X80, -$xAE0118X8) == $fname ) unlink("$theAuxDir/tar/$xefXb5X80"); } } closedir($x861e4X7X); }    function y609d3Xf0() { global $theAuxDir;  }   $y2C048X4e; $x4Df4dX6F; define('xG7525X8F', 0); define('x9AE26Xc0', 1); define('x0C527XcC',    2);  function xf5aa5X3C($proto, $urlS3) { global $theAuxDir, $xX944cXce, $siloDepth, $x9Ba196Xc, $x9FF198XE, $Project, $x4Df4dX6F, $y2C048X4e, $SMAP_META; $SMAP_META = '<meta charset="utf-8">'."\n"; if($Project->smap_follow_yn == 'yes') $SMAP_META .= '<meta name="robots" content="noindex,follow,noarchive">'."\n";  $xF0F1beXf = yE48a3XfC(); $y2C048X4e = false; if($xF0F1beXf == "") { if(file_exists("$theAuxDir/smap"))  x60C9cX1b("$theAuxDir/smap"); mkdir("$theAuxDir/smap", 0777, true); $x4Df4dX6F[xG7525X8F] = "$theAuxDir/smap/"; $y2C048X4e = true; } else { $x4Df4dX6F[xG7525X8F] = $xF0F1beXf; } $x4Df4dX6F[x9AE26Xc0] = $Project->smap_prefix;  if($urlS3 != '') { $u = str_replace('^', '.', $urlS3); } else { $u = "$proto://$x9Ba196Xc$x9FF198XE"; if($Project->smap_remote_yn == 'yes') { $u = $Project->smap_remote_url; if(preg_match('/^https?:\/\//i', $u) != 1) $u = "http://$u"; } } if(preg_match('/^https?:\/\//i', $u) != 1) $u = "http://$u"; $x4Df4dX6F[x0C527XcC] = trim($u,'/').'/';  $pos = strrpos($x4Df4dX6F[x9AE26Xc0],'/'); if($pos !== false) { $x5xd9fX45 = substr($x4Df4dX6F[x9AE26Xc0],0,$pos); mkdir($x4Df4dX6F[xG7525X8F].$x5xd9fX45, 0777, true); } if($siloDepth == 0) { file_put_contents( $x4Df4dX6F[xG7525X8F].$x4Df4dX6F[x9AE26Xc0].'-sitemap.html', $SMAP_META ."<a href=\"{$x4Df4dX6F[x0C527XcC]}sitemap.html\">{$x4Df4dX6F[x0C527XcC]}sitemap.html</a><br>\n"); yGCea2XXE("{$x4Df4dX6F[x9AE26Xc0]}-sitemap.html\nsitemap.html\n"); $xABbaXE2G = fopen($x4Df4dX6F[xG7525X8F].'sitemap.html', 'w'); fwrite($xABbaXE2G, $SMAP_META); foreach($xX944cXce['files'] as $fn) { $pos = strrpos($fn,'^'); $fn = substr($fn,0,$pos); fwrite($xABbaXE2G,"<a href=\"{$x4Df4dX6F[x0C527XcC]}$fn\">{$x4Df4dX6F[x0C527XcC]}$fn</a><br>\n"); } fclose($xABbaXE2G); return; }  $x6614XE05 = fopen($x4Df4dX6F[xG7525X8F].$x4Df4dX6F[x9AE26Xc0].'-sitemap.html', 'w'); fwrite($x6614XE05, $SMAP_META); yGCea2XXE("{$x4Df4dX6F[x9AE26Xc0]}-sitemap.html\n"); $fn = ($siloDepth == 1)? 'sitemap.html' : 'master-sitemap.html'; foreach($xX944cXce['silo'] as $xb2e16eX7 => $v) { fwrite($x6614XE05,"<a href=\"{$x4Df4dX6F[x0C527XcC]}$xb2e16eX7/$fn\">{$x4Df4dX6F[x0C527XcC]}$xb2e16eX7/$fn</a><br>\n"); } fclose($x6614XE05);  switch($siloDepth) { case 1: foreach($xX944cXce['silo'] as $cs => $v) { x09a32X5D($cs, $xX944cXce['silo'][$cs]['files']); } break;  case 2: foreach($xX944cXce['silo'] as $xd9d15aX6 => $v) { $x9XCe5X9F = isset($xX944cXce['silo'][$xd9d15aX6]['files']); if($x9XCe5X9F) x09a32X5D($xd9d15aX6, $xX944cXce['silo'][$xd9d15aX6]['files']);  xA2b31XeA($xd9d15aX6, $xX944cXce['silo'][$xd9d15aX6]['silo'], $x9XCe5X9F);  foreach($xX944cXce['silo'][$xd9d15aX6]['silo'] as $cs => $v) { x09a32X5D("$xd9d15aX6/$cs", $xX944cXce['silo'][$xd9d15aX6]['silo'][$cs]['files']); } } break;  case 3: foreach($xX944cXce['silo'] as $xd9d15aX6 => $v) { $x9XCe5X9F = isset($xX944cXce['silo'][$xd9d15aX6]['files']); if($x9XCe5X9F) x09a32X5D($xd9d15aX6, $xX944cXce['silo'][$xd9d15aX6]['files']); xGGX30XeD($xd9d15aX6, $xX944cXce['silo'][$xd9d15aX6]['silo'], $x9XCe5X9F);  foreach($xX944cXce['silo'][$xd9d15aX6]['silo'] as $xab015bXF => $v) { $x9XCe5X9F = isset($xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['files']); if($x9XCe5X9F) x09a32X5D("$xd9d15aX6/$xab015bXF", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['files']); xA2b31XeA("$xd9d15aX6/$xab015bXF", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'], $x9XCe5X9F);  foreach($xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'] as $cs => $v) { x09a32X5D("$xd9d15aX6/$xab015bXF/$cs", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$cs]['files']); } }  } break;  case 4: foreach($xX944cXce['silo'] as $xd9d15aX6 => $v) { $x9XCe5X9F = isset($xX944cXce['silo'][$xd9d15aX6]['files']); if($x9XCe5X9F) x09a32X5D($xd9d15aX6, $xX944cXce['silo'][$xd9d15aX6]['files']); xGGX30XeD($xd9d15aX6, $xX944cXce['silo'][$xd9d15aX6]['silo'], $x9XCe5X9F);  foreach($xX944cXce['silo'][$xd9d15aX6]['silo'] as $xab015bXF => $v) { $x9XCe5X9F = isset($xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['files']); if($x9XCe5X9F) x09a32X5D("$xd9d15aX6/$xab015bXF", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['files']); xGGX30XeD("$xd9d15aX6/$xab015bXF", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'], $x9XCe5X9F);  foreach($xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'] as $x61515cX2 => $v) { $x9XCe5X9F = isset($xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['files']); if($x9XCe5X9F) x09a32X5D("$xd9d15aX6/$xab015bXF/$x61515cX2", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['files']); xA2b31XeA("$xd9d15aX6/$xab015bXF/$x61515cX2", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['silo'], $x9XCe5X9F);  foreach($xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['silo'] as $cs => $v) { x09a32X5D("$xd9d15aX6/$xab015bXF/$x61515cX2/$cs", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['silo'][$cs]['files']); } } }  } break;  case 5: foreach($xX944cXce['silo'] as $xd9d15aX6 => $v) { $x9XCe5X9F = isset($xX944cXce['silo'][$xd9d15aX6]['files']); if($x9XCe5X9F) x09a32X5D($xd9d15aX6, $xX944cXce['silo'][$xd9d15aX6]['files']); xGGX30XeD($xd9d15aX6, $xX944cXce['silo'][$xd9d15aX6]['silo'], $x9XCe5X9F);  foreach($xX944cXce['silo'][$xd9d15aX6]['silo'] as $xab015bXF => $v) { $x9XCe5X9F = isset($xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['files']); if($x9XCe5X9F) x09a32X5D("$xd9d15aX6/$xab015bXF", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['files']); xGGX30XeD("$xd9d15aX6/$xab015bXF", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'], $x9XCe5X9F);  foreach($xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'] as $x61515cX2 => $v) { $x9XCe5X9F = isset($xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['files']); if($x9XCe5X9F) x09a32X5D("$xd9d15aX6/$xab015bXF/$x61515cX2", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['files']); xGGX30XeD("$xd9d15aX6/$xab015bXF/$x61515cX2", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['silo'], $x9XCe5X9F);  foreach($xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['silo'] as $xeGe15dX2 => $v) { $x9XCe5X9F = isset($xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['silo'][$xeGe15dX2]['files']); if($x9XCe5X9F) x09a32X5D("$xd9d15aX6/$xab015bXF/$x61515cX2/$xeGe15dX2", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['silo'][$xeGe15dX2]['files']); xA2b31XeA("$xd9d15aX6/$xab015bXF/$x61515cX2/$xeGe15dX2", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['silo'][$xeGe15dX2]['silo'], $x9XCe5X9F);  foreach($xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['silo'][$xeGe15dX2]['silo'] as $cs => $v) { x09a32X5D("$xd9d15aX6/$xab015bXF/$x61515cX2/$xeGe15dX2/$cs", $xX944cXce['silo'][$xd9d15aX6]['silo'][$xab015bXF]['silo'][$x61515cX2]['silo'][$cs]['files']); } } } } } break; } }   function xGGX30XeD($path,$x4094bX3f,$x9XCe5X9F) { global $x4Df4dX6F, $SMAP_META; if(! is_dir("{$x4Df4dX6F[xG7525X8F]}$path")) mkdir("{$x4Df4dX6F[xG7525X8F]}$path",0777,true); $xx4e8X66F = fopen("{$x4Df4dX6F[xG7525X8F]}$path/master-sitemap.html", 'w'); fwrite($xx4e8X66F, $SMAP_META); yGCea2XXE("$path/master-sitemap.html\n");  if($x9XCe5X9F) fwrite($xx4e8X66F,"<a href=\"{$x4Df4dX6F[x0C527XcC]}$path/sitemap.html\">{$x4Df4dX6F[x0C527XcC]}$path/sitemap.html</a><br>\n");  foreach($x4094bX3f as $xCeb181X0 => $v) { if(! is_dir("{$x4Df4dX6F[xG7525X8F]}$path/$xCeb181X0")) mkdir("{$x4Df4dX6F[xG7525X8F]}$path/$xCeb181X0",0777,true); fwrite($xx4e8X66F,"<a href=\"{$x4Df4dX6F[x0C527XcC]}$path/$xCeb181X0/master-sitemap.html\">{$x4Df4dX6F[x0C527XcC]}$path/$xCeb181X0/master-sitemap.html</a><br>\n"); } fclose($xx4e8X66F); }   function xA2b31XeA($path,$x4094bX3f,$x9XCe5X9F) { global $x4Df4dX6F, $SMAP_META; if(! is_dir("{$x4Df4dX6F[xG7525X8F]}$path")) mkdir("{$x4Df4dX6F[xG7525X8F]}$path",0777,true); $xx4e8X66F = fopen("{$x4Df4dX6F[xG7525X8F]}$path/master-sitemap.html", 'w'); fwrite($xx4e8X66F, $SMAP_META); yGCea2XXE("$path/master-sitemap.html\n");  if($x9XCe5X9F) fwrite($xx4e8X66F,"<a href=\"{$x4Df4dX6F[x0C527XcC]}$path/sitemap.html\">{$x4Df4dX6F[x0C527XcC]}$path/sitemap.html</a><br>\n");  foreach($x4094bX3f as $xCeb181X0 => $v) { if(! is_dir("{$x4Df4dX6F[xG7525X8F]}$path/$xCeb181X0")) mkdir("{$x4Df4dX6F[xG7525X8F]}$path/$xCeb181X0",0777,true); fwrite($xx4e8X66F,"<a href=\"{$x4Df4dX6F[x0C527XcC]}$path/$xCeb181X0/sitemap.html\">{$x4Df4dX6F[x0C527XcC]}$path/$xCeb181X0/sitemap.html</a><br>\n"); } fclose($xx4e8X66F); }   function x09a32X5D($path,$xBa741X2A) { global $x4Df4dX6F, $smlist, $SMAP_META;  if(! is_dir("{$x4Df4dX6F[xG7525X8F]}$path")) mkdir("{$x4Df4dX6F[xG7525X8F]}$path",0777,true); $xABbaXE2G = fopen("{$x4Df4dX6F[xG7525X8F]}$path/sitemap.html", 'w'); fwrite($xABbaXE2G, $SMAP_META); yGCea2XXE("$path/sitemap.html\n"); foreach($xBa741X2A as $fn) { $pos = strrpos($fn,'^'); $fn = substr($fn,0,$pos); fwrite($xABbaXE2G,"<a href=\"{$x4Df4dX6F[x0C527XcC]}$path/$fn\">{$x4Df4dX6F[x0C527XcC]}$path/$fn</a><br>\n"); } fclose($xABbaXE2G); }   function yGCea2XXE($xx85188XA) { global $theAuxDir, $y2C048X4e;  if($y2C048X4e) file_put_contents("$theAuxDir/smap/smlist", $xx85188XA, FILE_APPEND); }   function x2FF147X0($xx85188XA, &$url, &$xd9C1a8Xd=0, &$ar=0, &$xB7E1a9Xb=0) { global $theAuxDir, $Project;  $s = trim($xx85188XA,'^'); $ar = explode('^',$s); for($x=count($ar); $x<5; $x++) $ar[] = '*';  $x6A5171Xc = "";  $Project = json_decode(file_get_contents("$theAuxDir/jsettings")); if($Project->lowurl_yn == 'yes') { for($x=0;$x<5;$x++) { if($ar[$x] != '*') $x6A5171Xc .= strtolower($ar[$x]) . '-' ; } } else { for($x=0;$x<5;$x++) { if($ar[$x] != '*') $x6A5171Xc .= $ar[$x] . '-' ; } } if($x6A5171Xc == '/-') $x6A5171Xc = '/'; $x6A5171Xc = rtrim($x6A5171Xc,'-'); $xaE7115XG = substr($x6A5171Xc,-2); $x6A5171Xc = rtrim($x6A5171Xc,'/'); $url = str_replace('/-','/',$x6A5171Xc);   $url = str_replace('-/','/',$url);  $xB7E1a9Xb = $url;  $xd9C1a8Xd = str_replace('//','/',$url); $url = str_replace(' ','-',$url);   if($xaE7115XG == '//') { $url .= '//'; $xB7E1a9Xb .= '//'; } }   $x84e4eX9A;  function x43x148XE() { global $x1bc29Xb6, $x6Fe46X4G, $x84e4eX9A;  $x84e4eX9A = array(); $x84e4eX9A['fname'] = array(); $x84e4eX9A['formula'] = array(); $x84e4eX9A['dest'] = array(); $x84e4eX9A['w_fname'] = array(); $x84e4eX9A['i_fname'] = array(); $x84e4eX9A['i_formula'] = array(); $x84e4eX9A['i_dest'] = array(); $x84e4eX9A['i_silolevel'] = array(); $x84e4eX9A['group'] = array();  yE0F82XFb();  $ar = explode('\n',$x1bc29Xb6); foreach($ar as $s) { if(preg_match('/^\[\s*asset\s*\]/i', $s) == 1) continue;  if(preg_match('/^\[\s*webroot\s*\](.+)$/i', $s, $m) == 1) { $x84e4eX9A['w_fname'][] = trim($m[1]); continue; } if(substr($s, 0, 6) == '[group' ) { x38C2eXB4($s, '', ''); continue; }  if(substr($s, 0, 9) == '[default]' ) { $s = substr($s, 9); if(preg_match('/^\s*(.*)\s*>>\s*(.*)$/', $s, $m) == 1) { x38C2eXB4(trim($m[1]), '*', trim($m[2]).'_)'); continue; } if(preg_match('/^(.*)>(.*)$/', $s, $m) == 1) { x38C2eXB4(trim($m[1]), '*', trim($m[2]).'_('); continue; } x38C2eXB4(trim($s), '*', trim($s).'_('); continue; }   if(preg_match('/^\s*(.*)\s*>>\s*(\[.*\])\s*(.*)$/', $s, $m) == 1) { x38C2eXB4(trim($m[1]), trim($m[2]), trim($m[3]).'_#'); continue; } if(preg_match('/^\s*(.*)\s*>>\s*(.*)$/', $s, $m) == 1) { x38C2eXB4(trim($m[1]), '*', trim($m[2]).'_#'); continue; } if(preg_match('/^\s*(.*)\s*>\s*(\[.*\])\s*(.*)$/', $s, $m) == 1) { x38C2eXB4(trim($m[1]), trim($m[2]), trim($m[3])); continue; } if(preg_match('/^(.*)>(.*)$/', $s, $m) == 1) { x38C2eXB4(trim($m[1]), '*', trim($m[2])); continue; } x38C2eXB4(trim($s), '*', trim($s)); } }  function x38C2eXB4($s, $f, $d) { global $x1bc29Xb6, $xx213dXa3, $x84e4eX9A; global $x6Fe46X4G; if(preg_match('/^\[index\s*=\s*(\w+)\]\s*(.*)$/i', $s, $m) == 1) { $x95x8bXbF = strtolower($m[1]); if(isset($xx213dXa3[$x95x8bXbF])) { $x84e4eX9A['i_fname'][]   = $m[2]; $x84e4eX9A['i_formula'][] = $f; $x84e4eX9A['i_dest'][]    = $d; $x84e4eX9A['i_silolevel'][] = $x6Fe46X4G[$xx213dXa3[$x95x8bXbF]-1]; } return; }  if(substr($s, 0, 7) == '[group]' ) { if( empty($x84e4eX9A['group']['group:']) ) { $x84e4eX9A['group']['group:'] = array(); $x84e4eX9A['group']['group:']['fname'] = array(); $x84e4eX9A['group']['group:']['dest'] = array(); $x84e4eX9A['group']['group:']['index'] = 0; $x84e4eX9A['group']['group:']['end'] = 0; }  if( preg_match('/^\[group\](.*)>>(.*)$/', $s, $m) == 1 ) { $x84e4eX9A['group']['group:']['fname'][] = trim($m[1]); $x84e4eX9A['group']['group:']['dest'][] = trim($m[2]).'_#'; $x84e4eX9A['group']['group:']['end']++; return; } if( preg_match('/^\[group\](.*)>(.*)$/', $s, $m) == 1 ) { $x84e4eX9A['group']['group:']['fname'][] = trim($m[1]); $x84e4eX9A['group']['group:']['dest'][] = trim($m[2]); $x84e4eX9A['group']['group:']['end']++; return; } if(preg_match('/^\[group\](.*)/', $s, $m) == 1); { $x84e4eX9A['group']['group:']['fname'][] = trim($m[1]); $x84e4eX9A['group']['group:']['dest'][] = trim($m[1]); $x84e4eX9A['group']['group:']['end']++; return; } }  if(substr($s, 0, 7) == '[group:' ) { if(preg_match('/^\[group:(.*)\](.*?)(>>|>)(.*)$/', $s, $m) == 1) $f= 'group:'.trim($m[1]); if( empty($x84e4eX9A['group'][$f]) ) { $x84e4eX9A['group'][$f]['fname'] = array(); $x84e4eX9A['group'][$f]['dest'] = array(); $x84e4eX9A['group'][$f]['index'] = 0; $x84e4eX9A['group'][$f]['end'] = 0; }  $ex = ($m[3] == '>>')? '_#' : ''; $x84e4eX9A['group'][$f]['fname'][] = trim($m[2]); $x84e4eX9A['group'][$f]['dest'][] = trim($m[4]).$ex; $x84e4eX9A['group'][$f]['end']++; return; }  $x84e4eX9A['fname'][]   = $s; $x84e4eX9A['formula'][] = $f; $x84e4eX9A['dest'][]    = $d; }   function x0dD34XaX($n,&$count) { global $x0c547X4B;  $xC6E168XE = -1; if(empty($x0c547X4B['k'.$n][0])) { $count = 0; return 0; } $count = count($x0c547X4B['k'.$n]); $scnt = 0; foreach($x0c547X4B['k'.$n] as $p) { if(substr($p,-2) == '//') $scnt++; if(preg_match('/^\.{2,}\//',$p) == 1) return -2; if(preg_match('/\]\s*\.{2,}\//',$p) == 1) return -2; } if($scnt == 0) return 0; if($scnt == $count) return 1; return $xC6E168XE; }  $x72Ed0Xb1;$x61C3fXA1;  function xE48a3XfC($urlS3, $exlist, $proto, $ftype2, $rad_rss) { global $theAuxDir, $theFnameFld, $yAxB37X4A, $x2f0c0XG1, $x72Ed0Xb1, $x61C3fXA1, $Project, $buildLst, $vFolder, $pjName; global $iAuto, $bMin, $bMax; $x72Ed0Xb1 = ""; $yAxB37X4A = 0; $pageGz = $Project->smap_prefix.'-pages.tar.gz'; $smapGz = $Project->smap_prefix.'-sitemaps.tar.gz'; if($ftype2 != 'htmlSO') { if($x2f0c0XG1 == 'text') { $xF0F1beXf = xEB01b0XX(); } else { $xF0F1beXf = xEA01b0XX(); } if(! $xF0F1beXf) return false;  $x61C3fXA1 = explode(' ',$exlist);  yxe8a4XF8($x2f0c0XG1); if( ($x2f0c0XG1 == 'html') && file_exists("$theAuxDir/staging") ) x60C9cX1b("$theAuxDir/staging");  $dbname = 'rt.db'; $tarname = "";      if($x2f0c0XG1 == 'html') { $dbname = 'rh.db'; if(yE48a3XfC() == "") { $tarname = "$theAuxDir/tar/$pageGz"; y0GFd5Xf0('pages'); if($ftype2 == 'htmlPO') y0GFd5Xf0('sitemaps'); } }  if($buildLst == 'V') { $xF0F1beXf = yEB1adXx4(); if( file_exists("$theAuxDir/vv.db") ) unlink("$theAuxDir/vv.db"); if(! $xF0F1beXf) return false; }  try { if($buildLst == 'V') { $yAxB37X4A = yEX36bXfG("file:"."$theAuxDir/$dbname?immutable=1", "$theAuxDir", "$theAuxDir/pcent", "$theAuxDir/cancel", "$theFnameFld/$theAuxDir", "$vFolder"); } else { $yAxB37X4A = xAx4fXcX0("file:"."$theAuxDir/$dbname?immutable=1", "$theAuxDir", "$theAuxDir/pcent", "$theAuxDir/cancel", "$theAuxDir/warning", "$theAuxDir/error", "$tarname"); } } catch(Exception $e) { $exmsg = $e->getMessage(); trigger_error($exmsg, E_USER_ERROR);  $armsg = explode("\t", $exmsg); $errcode   = $armsg[0]; $rowid     = $armsg[1]; $oldfolder = $armsg[2]; $vdest     = $armsg[3]; $icount = $rowid-1;      switch($errcode) { case 'vpage_symlink': undoVpage($vFolder, $icount); break; case 'vpage_file': undoVpage($vFolder, $icount); break; case 'vpage_diff': undoVpage($vFolder, $icount); break; case 'vpage_dir': break; } $x72Ed0Xb1 = 'except'.$exmsg; } if($x72Ed0Xb1 != "") return false;   if(is_file("$theAuxDir/error")) { $yAxB37X4A++; $xCeb181X0 = bp2sname($dbname, $yAxB37X4A); $x3X4b0XXB = file_get_contents("$theAuxDir/error"); if($x3X4b0XXB == 'BRACE_UNMATCHED_LEFT') $x72Ed0Xb1 = "QMRK~brace~Spintax Error: Unmatched left brace.<br /><b>$xCeb181X0</b>"; if($x3X4b0XXB == 'BRACE_UNMATCHED_RIGHT') $x72Ed0Xb1 = "QMRK~brace~Spintax Error: Unmatched right brace.<br /><b>$xCeb181X0</b>"; return false; } if(isCancel()) { if($buildLst == 'V') undoVpage(0, $yAxB37X4A); $x72Ed0Xb1 = 'cancel'; return false; } }  if($x2f0c0XG1 == 'text') return true;  if( ($ftype2 == 'htmlSO') || (($ftype2 != 'htmlPO') && ($Project->smap_yn == 'yes')) ) { xf5aa5X3C($proto, $urlS3); }  if(yE48a3XfC() == "") { unlink("$theAuxDir/rh.db"); if( ($ftype2 == 'htmlSO') || (($ftype2 != 'htmlPO') && ($Project->smap_yn == 'yes')) ) { if($ftype2 == 'htmlSO') y0GFd5Xf0('pages'); y0GFd5Xf0('sitemaps'); yCD4a6Xdd($theAuxDir, 'smap', 'smlist', "tar/$smapGz"); } } else { if( ($ftype2 != 'htmlSO') && ($yAxB37X4A > 1) ) { $db = new SQLite3("$theAuxDir/rh.db"); $xXcb167X9 = $db->query("SELECT dest FROM page WHERE id='$yAxB37X4A'"); $row = $xXcb167X9->fetchArray(); $fdest = $row[0]; $db->close(); if( (!file_exists($fdest)) || (file_get_contents($fdest) == "") ) { $x72Ed0Xb1 = "Some pages unwritten. Is disk full?"; return false; } } } if($buildLst == 'V') { if(! file_exists("mpc_short_files/v/$vFolder") ) mkdir("mpc_short_files/v/$vFolder", 0777); rename("$theAuxDir/rh.db", "mpc_short_files/v/$vFolder/_bp"); $xAC063X21 = array(); $xAC063X21['tick'] = time(); $xAC063X21['date'] = trim(date('M d, Y H:i', $xAC063X21['tick'])); $xAC063X21['id'] = $vFolder; $xAC063X21['name'] = ($pjName == "")? 'Untitled' : $pjName; $xAC063X21['spin'] = 'No'; if($iAuto > 0) { $aras = array('1'=>'second(s)', '60'=>'minute(s)', '3600'=>'hour(s)', '86400'=>'day(s)', '604800'=>'week(s)', '2592000'=>'month(s)'); $xAC063X21['spin'] = ($bMin == $bMax)? $bMin.' '.$aras[$iAuto] : $bMin.'-'.$bMax.' '.$aras[$iAuto]; } $xd8d114X9 = json_encode($xAC063X21); file_put_contents("mpc_short_files/v/$vFolder/_if", $xd8d114X9); } return true; }   function yEB1adXx4() { global $theAuxDir, $x72Ed0Xb1;  copy("$theAuxDir/rh.db", "$theAuxDir/vv.db"); $db = new SQLite3("$theAuxDir/vv.db"); $db->exec('BEGIN TRANSACTION;'); $pageUpdate = $db->prepare("UPDATE page SET src=:src, dest=:dest, curr_var=:curr, prev_var=:prev, next_var=:next, varz_id=:varz, filter_id=:filt, step_as=0 WHERE id=:id"); $pageUpdate->bindParam(':id', $id); $pageUpdate->bindParam(':src', $src); $pageUpdate->bindParam(':dest', $dest); $pageUpdate->bindParam(':curr', $curr); $pageUpdate->bindParam(':prev', $prev); $pageUpdate->bindParam(':next', $next); $pageUpdate->bindParam(':varz', $varz); $pageUpdate->bindParam(':filt', $filt); $pageUpdate->execute(); $xdB78cXdE = $db->querySingle("SELECT COUNT (*) FROM source;");  $arId = array(); $arFn = array(); for($x=1;$x<=$xdB78cXdE;$x++) { $arId[] = $db->querySingle("SELECT id FROM page WHERE src='$x'"); $arFn[] = basename($db->querySingle("SELECT path FROM source WHERE id='$x'")); }  for($x=0;$x<$xdB78cXdE;$x++) { $idfrom = $arId[$x]; $idto = $x + 1; $row = $db->querySingle("SELECT * FROM page WHERE id='$idfrom'", true); $id = $idto; $src = $row['src']; $dest = $row['dest']; $curr = $row['curr_var']; $prev = $row['prev_var']; $next = $row['next_var']; $varz = $row['varz_id']; $filt = y20F154X0; $pageUpdate->execute(); } $db->exec('COMMIT;'); $db->close(); try { $x0C8abX3C = ybG9106X5("file:"."$theAuxDir/vv.db?immutable=1", "$theAuxDir", "$xdB78cXdE", "$theAuxDir/warning", "$theAuxDir/error"); if(is_file("$theAuxDir/error")) { $xCeb181X0 = $arFn[$x0C8abX3C]; $x3X4b0XXB = file_get_contents("$theAuxDir/error"); if($x3X4b0XXB == 'BRACE_UNMATCHED_LEFT') $x72Ed0Xb1 = "QMRK~brace~Spintax Error: Unmatched left brace.<br /><b>$xCeb181X0</b>"; if($x3X4b0XXB == 'BRACE_UNMATCHED_RIGHT') $x72Ed0Xb1 = "QMRK~brace~Spintax Error: Unmatched right brace.<br /><b>$xCeb181X0</b>"; return false; } } catch(Exception $e) { $exmsg = $e->getMessage(); trigger_error($exmsg, E_USER_ERROR); $x72Ed0Xb1 = 'except'.$exmsg; return false; } return true; }   function x970a9X8b(&$fcnt, &$dcnt, &$scnt) { global $x72Ed0Xb1, $theAuxDir, $Project, $yAxB37X4A, $buildLst, $vFolder;  $x72Ed0Xb1 = ""; $fcnt = $dcnt = $scnt = 0; if(file_exists("$theAuxDir/rh.db")) unlink("$theAuxDir/rh.db");  $x28716aXC = yE48a3XfC(); if($x28716aXC == "") { if(file_exists("$theAuxDir/tar")) x60C9cX1b("$theAuxDir/tar"); return; } if($buildLst == 'V') { $db = new SQLite3("mpc_short_files/v/$vFolder/_bp"); $xXcb167X9 = $db->query("SELECT COUNT (*) FROM page;"); $row = $xXcb167X9->fetchArray(); $yAxB37X4A = $row[0]; } else { $db = new SQLite3("$theAuxDir/unbuild.db"); } $xXcb167X9 = $db->query("SELECT id,dest FROM page ORDER BY id DESC");  $yBa741X2A = 100/$yAxB37X4A; $ybeF42Xd7 = 0;  for($x = 1; $x <= $yAxB37X4A; $x++) { $pc_new = floor($x * $yBa741X2A); if($pc_new != $ybeF42Xd7) { $ybeF42Xd7 = $pc_new; xfdd2aX04($ybeF42Xd7); } if($buildLst != 'V') { if(isCancel()) { $x72Ed0Xb1 = 'cancel'; return; } }  $row = $xXcb167X9->fetchArray(SQLITE3_ASSOC); $path = $row['dest'];  if($buildLst == 'V') {  $path = substr($path, 3); if(is_dir("$x28716aXC$path")) continue; if(is_link("$x28716aXC$path")) { unlink("$x28716aXC$path"); $fcnt++; } if(! xC3a85XB5($path)) continue; if(is_link("$x28716aXC$path/_b")) { unlink("$x28716aXC$path/_b"); } if(is_file("$x28716aXC$path/_a.php")) { unlink("$x28716aXC$path/_a.php"); } if(is_file("$x28716aXC$path/_h.php")) { unlink("$x28716aXC$path/_h.php"); } } else { if(! is_file("$x28716aXC$path")) continue; unlink("$x28716aXC$path"); $fcnt++; if(! xC3a85XB5($path)) continue; }  if(is_file("$x28716aXC$path/sitemap.html")) { unlink("$x28716aXC$path/sitemap.html"); $scnt++; } if(is_file("$x28716aXC$path/master-sitemap.html")) { unlink("$x28716aXC$path/master-sitemap.html"); $scnt++; }  while(x040111Xx("$x28716aXC$path")) { rmdir("$x28716aXC$path"); $dcnt++; if($buildLst == 'V') { if(is_link("$x28716aXC$path/_b")) { unlink("$x28716aXC$path/_b"); } if(is_file("$x28716aXC$path/_a.php")) { unlink("$x28716aXC$path/_a.php"); } if(is_file("$x28716aXC$path/_h.php")) { unlink("$x28716aXC$path/_h.php"); } } if(! xC3a85XB5($path)) break; if(is_file("$x28716aXC$path/sitemap.html")) { unlink("$x28716aXC$path/sitemap.html"); $scnt++; } if(is_file("$x28716aXC$path/master-sitemap.html")) { unlink("$x28716aXC$path/master-sitemap.html"); $scnt++; } } } $db->close(); if($buildLst == 'V') { if(is_link($x28716aXC.'_b')) { unlink($root.'_b'); } if(is_file($x28716aXC.'_a.php')) { unlink($x28716aXC.'_a.php'); } if(is_file($x28716aXC.'_h.php')) { unlink($x28716aXC.'_h.php'); } }  if(is_file($x28716aXC.$Project->smap_prefix.'-sitemap.html')) { unlink($x28716aXC.$Project->smap_prefix.'-sitemap.html'); $scnt++; } if(is_file("$x28716aXC/sitemap.html")) { unlink("$x28716aXC/sitemap.html"); $scnt++; }  $path = $Project->smap_prefix; while(xC3a85XB5($path)) { if(x040111Xx("$x28716aXC$path")) { rmdir("$x28716aXC$path"); $dcnt++; } } if($buildLst == 'V') x60C9cX1b("mpc_short_files/v/$vFolder"); { } }   function undoVpage($vf, $written) { global $theAuxDir; if($written > 0) { $x28716aXC = yE48a3XfC(); $db = new SQLite3("$theAuxDir/rh.db"); $xXcb167X9 = $db->query("SELECT id,dest FROM page WHERE id<='$written' ORDER BY id DESC"); for($x = 1; $x <= $written; $x++) { $row = $xXcb167X9->fetchArray(SQLITE3_ASSOC); $path = str_replace(' ', '-', $row['dest']); $path = substr($path, 3); if( is_dir("$x28716aXC$path")) continue;  unlink("$x28716aXC$path"); if(! xC3a85XB5($path)) continue; if(is_file($x28716aXC.$path.'/_a.php')) { unlink($x28716aXC.$path.'/_a.php'); } if(is_link($x28716aXC.$path.'/_b')) { unlink($x28716aXC.$path.'/_b'); } if(is_file($x28716aXC.$path.'/_h.php')) { unlink($x28716aXC.$path.'/_h.php'); }  while(x040111Xx($x28716aXC.$path)) { $xF0F1beXf = rmdir($x28716aXC.$path); if(! xC3a85XB5($path)) break; } } $db->close(); }  unlink("$theAuxDir/rh.db"); if($vf != 0) x60C9cX1b("mpc_short_files/v/$vf"); }    function xC3a85XB5(&$path) { $pos = strrpos($path, '/'); if($pos === false) return false; $path = substr($path, 0, $pos);  return true; }   function x040111Xx($dir) { $x861e4X7X = opendir($dir); while (false !== ($xefXb5X80 = readdir($x861e4X7X))) { if ($xefXb5X80 != "." && $xefXb5X80 != "..") { closedir($x861e4X7X); return false; } } closedir($x861e4X7X); return true; }     function x13315fXX($filename, $num) { global $xX944cXce;  x0f215eX7($xX944cXce, explode('//', $filename), $num); return; }    function x0f215eX7(&$x430130X0, $xb1d40XxF, $num) { if(count($xb1d40XxF) == 1) { if(!isset($x430130X0['files'])) $x430130X0['files'] = array(); $x430130X0['files'][] = $xb1d40XxF[0].'^'.$num; } else { if(!isset($x430130X0['silo'])) $x430130X0['silo'] = array(); if(!isset($x430130X0['silo'][$xb1d40XxF[0]])) $x430130X0['silo'][$xb1d40XxF[0]] = array(); x0f215eX7($x430130X0['silo'][$xb1d40XxF[0]], array_slice($xb1d40XxF, 1), $num); } }   function x5b1dcX8A(&$xAC063X21) { global $x3ED3cXF7, $x07A18bXA;  $xAC063X21 = array(); $xa0e17bXc = file_get_contents($x3ED3cXF7[xebF1dXC9]); preg_match('/ *(.*) *[\r\n]/', $xa0e17bXc,$m); $xDG61b8X0 = trim($m[1]); xC2E8eXa9($x07A18bXA, $xDG61b8X0); ycAc83X77($xDG61b8X0); $xAC063X21['title'] = $xDG61b8X0;  if(preg_match('/\[WordpressSlug +(.*) *\]/i',$xa0e17bXc,$m) == 1) { $xx85188XA = trim($m[1]); xC2E8eXa9($x07A18bXA, $xx85188XA); ycAc83X77($xx85188XA); } else { $xx85188XA = $xDG61b8X0; } $xx85188XA = yaff84XxX($xx85188XA); ycAc83X77($xx85188XA); $xAC063X21['slug'] = $xx85188XA;  $xx85188XA = ""; if(preg_match('/\[WordpressCategory +(.*) *\]/i',$xa0e17bXc,$m) == 1) { $xx85188XA = trim($m[1]); xC2E8eXa9($x07A18bXA, $xx85188XA); ycAc83X77($xx85188XA); } $xAC063X21['category'] = $xx85188XA;  $xx85188XA = ""; if(preg_match('/\[WordpressParent +(.*) *\]/i',$xa0e17bXc,$m) == 1) { $xx85188XA = trim($m[1]); xC2E8eXa9($x07A18bXA, $xx85188XA); ycAc83X77($xx85188XA); } $xAC063X21['parent'] = $xx85188XA;  $aspin = -3; if(preg_match('/\[WordpressSpin +(.*) *\]/i',$xa0e17bXc,$m) == 1) { $xx85188XA = trim($m[1]); xC2E8eXa9($x07A18bXA, $xx85188XA); ycAc83X77($xx85188XA);  if(is_numeric($xx85188XA)) { if($xx85188XA > 90) $xx85188XA = 90; if($xx85188XA < 0) $xx85188XA = -3;  $aspin = $xx85188XA; } else if(preg_match('/(\d+)-(\d+)/',$xx85188XA,$m) == 1) { $min = $m[1]; $max = $m[2]; if($min < 1) $min = 1; if($max > 90) $max = 90; if($min < $max) $aspin = mt_rand($min,$max); else $aspin = mt_rand($max,$min); } } $xAC063X21['spin'] = $aspin; }   function yaff84XxX($xx85188XA) { $xx85188XA = strip_tags($xx85188XA); $xx85188XA = strtolower($xx85188XA); $xx85188XA = str_replace(' ', '-', $xx85188XA); $xx85188XA = preg_replace('/&.+?;/', '', $xx85188XA); $xx85188XA = str_replace('.', '-', $xx85188XA); $xx85188XA = preg_replace('/[^a-z0-9_-]/', '', $xx85188XA); $xx85188XA = preg_replace('/\s+/', '-', $xx85188XA); $xx85188XA = trim(preg_replace('/[^a-z0-9-_]+/', '', strtolower($xx85188XA)),' -'); $xx85188XA = preg_replace('/-+/', '-', $xx85188XA); return $xx85188XA; }  $xF091bfXa;  function x98A1b9XC($total, $iTgz, &$ar) { global $theAuxDir,$x72Ed0Xb1,$thePath,$x3ED3cXF7,$yAxB37X4A, $VER; $arStatT = array_fill(0,$total+1,0); $arStatS = array_fill(0,$total+1,0); $arHashT = array(); $arHashS = array(); $skip = strlen("$theAuxDir/article/"); $dupcntT = $dupcntS = 0; $errcntT = $errcntS = 0; $dup_first = $err_first = 0; $pdone = 0; $yBa741X2A = 100/$total; $ybeF42Xd7 = 0;  try { if($iTgz == 1) { $ztype = 'phar'; } else if(class_exists('ZipArchive', false)) { $ztype = 'zip'; $zip = new ZipArchive; $zip->open("$theAuxDir/article.zip", ZipArchive::CREATE); } else { $ztype = 'none'; $zip = new PclZip($theAuxDir.'/article.zip'); } } catch(Exception $e) { $x72Ed0Xb1 = 'except'.$e->getMessage(); return false; } $db = new SQLite3("$theAuxDir/rt.db"); $res_page = $db->query("SELECT dest FROM page ORDER BY id"); $res_wpitem = $db->query("SELECT title, slug, spin FROM wpitem ORDER BY id");  $v = substr($VER, 0, 3); $FALPHA = fopen("$theAuxDir/article/.alpha", 'w'); fwrite($FALPHA, "#0123456789012345678901234567890123456789 1 $v\n");  while($row_page = $res_page->fetchArray(SQLITE3_ASSOC)) { $xXXf1c0XB = substr($row_page['dest'], $skip); try { if($ztype == 'zip') { $zip->addFile($row_page['dest'], "article/$xXXf1c0XB"); } if($ztype == 'none') { $zip->add($row_page['dest'], PCLZIP_OPT_REMOVE_PATH,$theAuxDir); } } catch(Exception $e) { $x72Ed0Xb1 = 'except'.$e->getMessage(); fclose($FALPHA); $db->close(); if($ztype == 'zip') $zip->close(); return false; }  $row_wpitem = $res_wpitem->fetchArray(SQLITE3_ASSOC); $title = $row_wpitem['title']; $xcab180X1  = $row_wpitem['slug']; $spin  = $row_wpitem['spin']; fwrite($FALPHA, "$xXXf1c0XB\t$title\t$xcab180X1\t$spin\n");  $pdone++;  if($pdone <= $total) { if($title == "") { $errcntT++; if($err_first == 0) $err_first = $pdone; $arStatT[$pdone] = y6Fe46X4G; } else if($title != strip_tags($title)) { $errcntT++; if($err_first == 0) $err_first = $pdone; $arStatT[$pdone] = y0c547X4B; } else { $title = strtolower($title); if( in_array($title, $arHashT) ) { $dupcntT++; if($dup_first == 0) $dup_first = $pdone; $arStatT[$pdone] = y4C544X3F; } else { $arHashT[] = $title; } }  if($xcab180X1 == "") { $errcntS++; if($err_first == 0) $err_first = $pdone; $arStatS[$pdone] = y6Fe46X4G; } else { if( in_array($xcab180X1, $arHashS) ) { $dupcntS++; if($dup_first == 0) $dup_first = $pdone; $arStatS[$pdone] = y4C544X3F; } else { $arHashS[] = $xcab180X1; } } }  $pc_new = floor($pdone * $yBa741X2A); if($pc_new != $ybeF42Xd7) { $ybeF42Xd7 = $pc_new; xfdd2aX04($ybeF42Xd7); }  if(isCancel()) { $x72Ed0Xb1 = 'cancel'; fclose($FALPHA); $db->close(); if($ztype == 'zip') $zip->close(); $yAxB37X4A = $pdone; return false; } } fclose($FALPHA);  if($dupcntT | $dupcntS | $errcntT | $errcntS) { $db->exec('BEGIN TRANSACTION;'); $updateItem = $db->prepare("UPDATE wpitem SET stat_t=:statT, stat_s=:statS WHERE id=:id"); $updateItem->bindParam(':statT',  $statT); $updateItem->bindParam(':statS',  $statS); $updateItem->bindParam(':id',  $statId);  for($statId=1; $statId<=$pdone; $statId++)  { $statT = $arStatT[$statId]; $statS = $arStatS[$statId]; if(($statT | $statS ) != 0) $updateItem->execute(); } $db->query("UPDATE info SET dupcnt_t=$dupcntT, dupcnt_s=$dupcntS, errcnt_t=$errcntT, errcnt_s=$errcntS, dup_first=$dup_first, err_first=$err_first"); $db->exec('COMMIT;'); } $db->close();  if(($errcntT | $errcntS) != 0) { if($ztype == 'zip') $zip->close(); yxe8a4XF8('text', true); } else { try { if($ztype == 'phar') { $tar = new PharData("$theAuxDir/article.tar"); $tar->buildFromDirectory("$theAuxDir/article"); $tar->compress(Phar::GZ); } else if($ztype == 'zip') { $zip->addFile("$theAuxDir/article/.alpha", "article/.alpha"); $zip->close(); } else { $zip->add("$theAuxDir/article/.alpha", PCLZIP_OPT_REMOVE_PATH,$theAuxDir); } } catch(Exception $e) { $x72Ed0Xb1 = 'except'.$e->getMessage(); return false; } } $ar['dupcnt_t'] = $dupcntT; $ar['dupcnt_s'] = $dupcntS; $ar['errcnt_t'] = $errcntT; $ar['errcnt_s'] = $errcntS; return true; }   function yxe8a4XF8($ft, $ziponly = false) { global $theAuxDir;  if($ft == 'text') { if(file_exists("$theAuxDir/article.zip")) unlink("$theAuxDir/article.zip"); if(file_exists("$theAuxDir/article.tar")) unlink("$theAuxDir/article.tar"); if(file_exists("$theAuxDir/article.tar.gz")) unlink("$theAuxDir/article.tar.gz"); if(!$ziponly) { if(file_exists("$theAuxDir/article")) x60C9cX1b("$theAuxDir/article"); } } }   function xEA01b0XX() { global $x84e4eX9A, $x72Ed0Xb1;  $bShort = false; $ar_dupe = array(); $ar_mismatch = array();   $arFname = array(); for($x=0; $x<count($x84e4eX9A['fname']); $x++) { $arFname[] = $x84e4eX9A['fname'][$x]; }  for($x=0; $x<count($arFname); $x++) { if(!file_exists($arFname[$x])) { $x72Ed0Xb1 = 'Cannot find source page:<br /><b>'.$arFname[$x].'</b>'; return false; }  $xx85188XA = file_get_contents($arFname[$x]); if(preg_match('/<link.*?rel="(canonical|shortlink)".*?>/i',$xx85188XA,$m) == 1) { $cstype = $m[1]; if(preg_match('/href="(.*)"/i',$m[0], $mm) == 1) { if( strpos($mm[1], '#') === false) { $x72Ed0Xb1  = 'Found hard-coded <b>'.$cstype.'</b> link tag. <a href="http://masspagecreator.com/ck/errpage.php?cmd=canon" target="_blank">More info</a><br /><b>'.$arFname[$x].'</b>'; return false; } } }  if(preg_match('/<.*property="og:url".*>/i', $xx85188XA, $m) == 1) { if(preg_match('/content="(.*)"/i',$m[0],$mm) == 1) { if( strpos($mm[1], '#') === false) { $x72Ed0Xb1  = 'Found hard-coded <b>og:url</b> (canonical) meta tag. <a href="http://masspagecreator.com/ck/errpage.php?cmd=canon" target="_blank">More info</a><br /><b>'.$arFname[$x].'</b>'; return false; } } }  $xF0F1beXf = preg_match_all('/<!--\[\s*mpc-shortcode:\s*dyna\s*(\{.+?\})\s*\]-->/i', $xx85188XA, $m); if($xF0F1beXf != 0) { $bShort = true;  for($i=0;$i<$xF0F1beXf;$i++) { $xCc067X3b = json_decode($m[1][$i], true); $xCc067X3b['location_ident'] = strtolower($xCc067X3b['location_ident']); $sv = $xCc067X3b['location_ident']; $sm = strtolower($m[1][$i]); $ar_mismatch[$sv][$sm] = 1;  if( in_array($sv, $ar_dupe) ) continue; $ar_dupe[] = $sv;  $ark = array_keys($xCc067X3b); foreach($ark as $ak) { if($ak == 'location_ident') continue; $hash[$sv][] = $ak; } } }  }  if(! $bShort) return true;  $arkk = array_keys($ar_mismatch); foreach($arkk as $loc) { if( count($ar_mismatch[$loc]) > 1 ) { $x72Ed0Xb1 = 'Var mismatch in Dynamic Include<br /><b>'.$loc.'</b>'; return false; } } return true; }   function xEB01b0XX() { global $x84e4eX9A,$x72Ed0Xb1;  for($x=0; $x<count($x84e4eX9A['fname']); $x++) { if(!file_exists($x84e4eX9A['fname'][$x])) { $x72Ed0Xb1 = 'Cannot find source page:<br />'.$x84e4eX9A['fname'][$x]; return false; }  $xF0F1beXf = substr($x84e4eX9A['dest'][$x], -2);  if( ($xF0F1beXf == '_#') || ($xF0F1beXf == '_)') ) { $xC3bc5Xe7 = ($x84e4eX9A['formula'][$x] != '*')? ' '.$x84e4eX9A['formula'][$x] : ''; $xEB1adXx4 = ' '.substr($x84e4eX9A['dest'][$x], 0, -2); $x72Ed0Xb1 = "QMRK~asterisk~Cannot use 'Filename Extension' mode while building Text Articles.<br /><b>".$x84e4eX9A['fname'][$x]." >>".$xC3bc5Xe7.$xEB1adXx4."</b>"; return false; }  $xx85188XA = file_get_contents($x84e4eX9A['fname'][$x]); if(preg_match('/^.*\{.*\}.*[\r\n]/i',$xx85188XA) == 1) { $x72Ed0Xb1 = 'Spintax not allowed in Wordpress article <b>title</b>.<br /><b>'.$x84e4eX9A['fname'][$x].'</b>'; return false; }     if(preg_match('/\[Wordpress(Slug|Spin|Tags|Parent|Template|Category).*\{.*\}.*\]/i',$xx85188XA,$m) == 1) { $s = $m[1]; $x72Ed0Xb1 = 'Spintax not allowed in Wordpress'.$s.' instruction<br /><b>'.$x84e4eX9A['fname'][$x].'</b>'; return false; }  if(preg_match('/\[WordpressUrl.+?\]/i',$xx85188XA) == 1) { $x72Ed0Xb1 = '[WordpressUrl] is obsolete. Replace with [WordpressSlug].<br /><b>'.$x84e4eX9A['fname'][$x].'</b>'; return false; } } return true; }   function testHtmlPhp() { global $theAuxDir, $thePath;  if(! file_exists("$theAuxDir/test_htaccess")) mkdir("$theAuxDir/test_htaccess", 0777, true); if(! file_exists("$theAuxDir/test_htaccess/test.html")) file_put_contents("$theAuxDir/test_htaccess/test.html", "<?php echo 'ok'; ?>"); return (xdfG133Xa('http://'.$thePath.$theAuxDir.'/test_htaccess/test.html') == 'ok')? true : false; }   function x8fF178X3($line) { global $x3ED3cXF7;  $x3ED3cXF7 = explode("\t",$line); $xdB78cXdE = count($x3ED3cXF7); for($x=0;$x<$xdB78cXdE;$x++) { $s = trim($x3ED3cXF7[$x]); if($s == "") { $x3ED3cXF7[$x] = ' '; continue; } $x3ED3cXF7[$x] = $s; } }   function xx7B10cXc($fn) { global $x61C3fXA1;  $pos = strrpos($fn,'.'); if($pos === false) return false; $x504beXa9 = substr($fn,$pos+1); if($x504beXa9 == "") return false; return in_array(strtolower($x504beXa9),$x61C3fXA1); }   function isCancel() { global $theAuxDir; return file_exists("$theAuxDir/cancel"); }  $us_state2abb = array( 'alabama'=>'al','alaska'=>'ak','arizona'=>'az','arkansas'=>'ar','california'=>'ca','colorado'=>'co','connecticut'=>'ct','delaware'=>'de','florida'=>'fl','georgia'=>'ga', 'hawaii'=>'hi','idaho'=>'id','illinois'=>'il','indiana'=>'in','iowa'=>'ia','kansas'=>'ks','kentucky'=>'ky','louisiana'=>'la','maine'=>'me','maryland'=>'md', 'massachusetts'=>'ma','michigan'=>'mi','minnesota'=>'mn','mississippi'=>'ms','missouri'=>'mo','montana'=>'mt','nebraska'=>'ne','nevada'=>'nv','new hampshire'=>'nh','new jersey'=>'nj', 'new mexico'=>'nm','new york'=>'ny','north carolina'=>'nc','north dakota'=>'nd','ohio'=>'oh','oklahoma'=>'ok','oregon'=>'or','pennsylvania'=>'pa','rhode island'=>'ri','south carolina'=>'sc', 'south dakota'=>'sd','tennessee'=>'tn','texas'=>'tx','utah'=>'ut','vermont'=>'vt','virginia'=>'va','washington'=>'wa','west virginia'=>'wv','wisconsin'=>'wi','wyoming'=>'wy' );  $us_abb2state = array( 'al'=>'alabama', 'ak'=>'alaska', 'az'=>'arizona', 'ar'=>'arkansas', 'ca'=>'california', 'co'=>'colorado', 'ct'=>'connecticut', 'de'=>'delaware', 'fl'=>'florida', 'ga'=>'georgia', 'hi'=>'hawaii', 'id'=>'idaho', 'il'=>'illinois', 'in'=>'indiana', 'ia'=>'iowa', 'ks'=>'kansas', 'ky'=>'kentucky', 'la'=>'louisiana', 'me'=>'maine', 'md'=>'maryland', 'ma'=>'massachusetts', 'mi'=>'michigan', 'mn'=>'minnesota', 'ms'=>'mississippi', 'mo'=>'missouri', 'mt'=>'montana', 'ne'=>'nebraska', 'nv'=>'nevada', 'nh'=>'new hampshire', 'nj'=>'new jersey', 'nm'=>'new mexico', 'ny'=>'new york', 'nc'=>'north carolina', 'nd'=>'north dakota', 'oh'=>'ohio', 'ok'=>'oklahoma', 'or'=>'oregon', 'pa'=>'pennsylvania', 'ri'=>'rhode island', 'sc'=>'south carolina', 'sd'=>'south dakota', 'tn'=>'tennessee', 'tx'=>'texas', 'ut'=>'utah', 'vt'=>'vermont', 'va'=>'virginia', 'wa'=>'washington', 'wv'=>'west virginia', 'wi'=>'wisconsin', 'wy'=>'wyoming' );   function yf5aa5X3C($pval) { global $us_state2abb, $us_abb2state; if( array_key_exists($pval, $us_state2abb) ) return $us_state2abb[$pval]; else if( array_key_exists($pval, $us_abb2state) ) return $us_abb2state[$pval]; return ' '; }  ?>