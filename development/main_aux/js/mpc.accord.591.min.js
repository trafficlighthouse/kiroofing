//////////////////
//
//
//
jQuery(document).ready(function() {
	//
	// init accordion
	//
	$('#accordion').accordion();

	$('#accordion').css('visibility','visible');
});

function pnboxPrev()
{
	var x = $('#f6item').html();
	x--;
	if(x < 1) x = 1;
	$('#f6item').html(x);
}
function pnboxNext()
{
	var x = $('#f6item').html();
	x++;
	$('#f6item').html(x);
}

//////////////////
//
// enter: f#path# as id
//   1st #.. arSelPath index
//   2nd #.. id num
//
function pathSelect(p) {
	var x;
	var id = p.id;
	var idroot = id.substr(0,6);
	var idnum = id.substr(6);

   for(x=1;x<6;x++) {
      $('#'+idroot+x).toggleClass('fsel',false);
   }
   $('#'+id).toggleClass('fsel',true);
   return false;
}

function divSelect(p,n) {
	var x;
	var id = p.id;
	var idroot = id.substr(0,id.length-1);
	var idnum = id.charAt(id.length-1);
   for(x=1;x<=n;x++) {
      $('#'+idroot+x).toggleClass('fsel',false);
   }
   $('#'+id).toggleClass('fsel',true);
   return false;
}

var arcmp = ['x','=','!','~'];

function putFormula() {
	var x,c,s,p,pth,pts;
	for(x=1;x<9;x++) {
		if($('#acc'+x).hasClass('selected')) {
			break;
		}
	}
	switch(x) {
		// --------------------------------
		case 1: // [path]
		// --------------------------------
			x = getSelected('f1path',5);
			if(x==0)
			{
				showDiaStatus('Path not selected');
				$('.tdv').toggleClass('pinkback',true);
				return;
			}
			parent.MpcCpanel.pushVarbox('['+$('#f1path'+x).text()+']');
			break;

		// --------------------------------
		case 2: // [path=???]
		// --------------------------------
			x = getSelected('f2path',5);
			if(x==0)
			{
				showDiaStatus('Path not selected');
				$('.tdv').toggleClass('pinkback',true);
				return;
			}
			s = $('#f2search').val();
			if(s=="")
			{
				showDiaStatus('Search string not entered');
				$('input.tds').css('backgroundColor','pink');
				return;
			}
			c = getSelected('f2cmp',3);
			if(c==0)
			{
				showDiaStatus('Compare type not selected');
				$('.tdc').toggleClass('pinkback',true);
				return;
			}
			c = arcmp[c];
			p = $('#f2out').val();
			if(p=="")
			{
				showDiaStatus('Output string not entered');
				$('input.tdo').css('backgroundColor','pink');
				return;
			}
			parent.MpcCpanel.pushVarbox('['+$('#f2path'+x).text()+c+s+']'+p);
			break;

		// --------------------------------
		case 3: // [=???] output
		// --------------------------------
			c = getSelected('f3cmp',3);
			if(c==0)
			{
				showDiaStatus('Compare type not selected');
				$('.tdc').toggleClass('pinkback',true);
				return;
			}
			c = arcmp[c];
			s = $('#f3search').val();
			if(s=="")
			{
				showDiaStatus('Search string not entered');
				$('input.tds').css('backgroundColor','pink');
				return;
			}
			p = $('#f3out').val();
			if(p=="")
			{
				showDiaStatus('Output string not entered');
				$('input.tdo').css('backgroundColor','pink');
				return;
			}
			parent.MpcCpanel.pushVarbox('['+c+s+']'+p);
			break;

		// --------------------------------
		case 4: // [==???] output
		// --------------------------------
			c = getSelected('f4cmp',3);
			if(c==0)
			{
				showDiaStatus('Compare type not selected');
				$('.tdc').toggleClass('pinkback',true);
				return;
			}
			c = arcmp[c];
			s = $('#f4search').val();
			if(s=="")
			{
				showDiaStatus('Search string not entered');
				$('input.tds').css('backgroundColor','pink');
				return;
			}
			p = $('#f4out').val();
			if(p=="")
			{
				showDiaStatus('Output string not entered');
				$('input.tdo').css('backgroundColor','pink');
				return;
			}
			parent.MpcCpanel.pushVarbox('['+c+c+s+']'+p);
			break;

		// --------------------------------
		case 5: // Regex
		// --------------------------------
			s = $('#f5pattern').val();
			if(s=="")
			{
				showDiaStatus('Pattern string not entered');
				$('input.tdx').css('backgroundColor','pink');
				return;
			}
			if(s.charAt(0) != '/')
			{
				showDiaStatus("Pattern must be delimited by '/' slashes");
				$('input.tdx').css('backgroundColor','pink');
				return;
			}
			p = $('#f5out').val();
			if(p=="")
			{
				showDiaStatus('Output string not entered');
				$('input.tdo').css('backgroundColor','pink');
				return;
			}
			parent.MpcCpanel.pushVarbox('['+s+']'+p);
			break;

		// --------------------------------
		case 6: // Aligned Items
		// --------------------------------
			// path string
			pth = getSelected('f6path',5);
			if(pth == 0)
			{
				showDiaStatus('Path not selected');
				$('.tdv').toggleClass('pinkback',true);
				return;
			}
			pts = $('#f6path'+pth).text()

			// selection
			var sel = $('#f6item').html();
			sel = parseInt(sel);	
			sel--; // 0-x

			// separator
			sep = "";
			if($('#cbDash').prop('checked')) sep += '-';
			if($('#cbUnderscore').prop('checked')) sep += '_';
			if($('#cbFolders').prop('checked')) sep += '\\/';
			if($('#cbSpace').prop('checked')) sep += ' ';
			if(sep == "")
			{
				showDiaStatus('Separator not selected');
				$('.tdk').css('backgroundColor','pink');
				return;
			}

			// put in var box
			s = '[:'+pts+':/(?:[^'+sep+']+.){'+sel+'}([^'+sep+']+)/]$1';
			parent.MpcCpanel.pushVarbox(s);
			break;

		// --------------------------------
		case 7: // function(path)
		// --------------------------------
			pth = getSelected('f7path',5);
			pts = $('#f7path'+pth).text()
            c = jQuery('input:radio[name=func7]:checked').val(); // function name
			parent.MpcCpanel.pushVarbox('[('+pts+')] '+c);
            break;

		// --------------------------------
		case 8: // function(state, city)
		// --------------------------------
            pstate = $('#selState').val();
            if(pstate == '--')
            {
				showDiaStatus('State must be selected');
				$('.sels').css('backgroundColor','pink');
				return;
            }
            pcity = $('#selCity').val();
            if(pcity == '--')
            {
				showDiaStatus('City must be selected');
				$('.selc').css('backgroundColor','pink');
				return;
            }
            if(pstate == pcity)
            {
				showDiaStatus('State and City are same Path');
				$('.sels').css('backgroundColor','pink');
				$('.selc').css('backgroundColor','pink');
				return;
            }
            cbox = jQuery('#selZip').val(); // 0-3

            f = jQuery('input:radio[name=func8]:checked').val(); // function name
			parent.MpcCpanel.pushVarbox('[('+pstate+','+pcity+','+cbox+')] '+f);
            break;
	}
}

function getSelected(rootid,max) {
	var x,retval = 0; // not found

	for(var x=1;x<max+1;x++) {
		if($('#'+rootid+x).hasClass('fsel')) {
			retval = x;
			break;
		}	
	}
	return retval;
}

function updateZipDb()
{
    $.ajax({
        url: 'ajax.php',
        async: true,
        type:'POST',
        data: {cmd_ajax:'ajax_updb', mpc_ajax:64 },
        success: function(r) {
            $('#updb').css('visibility','visible');
            $('#updb_a').css('display','none');
        }
    });
}

function showDiaStatus(msg) {
	var el = jQuery('.dia-status');
	el.html(msg);
	//el.css({'color':rgb,'visibility':'visible'});
	el.css({'visibility':'visible'});
}
function hideDiaStatus() {
	$('.tdv').toggleClass('pinkback',false);
	$('.tdc').toggleClass('pinkback',false);
	$('input.tds').css('backgroundColor','white');
	$('input.tdo').css('backgroundColor','white');
	$('input.tdx').css('backgroundColor','white');
	$('.tdk').css('backgroundColor','white');
	$('.sel').css('backgroundColor','white');
	var el = jQuery('.dia-status');
	el.css('visibility','hidden');
	el.html('');
}
hideDiaStatusK = function(event) {
	var kc = ('which' in event)? event.which : event.keyCode;
	if(kc != 13) {
		var el = jQuery('.dia-status');
		el.css('visibility','hidden');
		el.html('');
	}
	return false;
}
