(function(e,d,a,f){e.single=(function(){var g=e({});return function(h){g[0]=h;return g}}());e.fn.contextMenu=function(j,g,i){if(!b[j]){i=g;g=j;j="popup"}else{if(g){if(!((g instanceof Array)||(typeof g==="string")||(g.nodeType)||(g.jquery))){i=g;g=null}}}if((g instanceof Array)&&(j!="update")){j="menu"}var h=i;if(e.inArray(j,["menu","popup","close","destroy"])>-1){i=c.optionOtimizer(j,i);this.each(function(){var k=e(this);h=e.extend({},e.fn.contextMenu.defaults,i);if(!h.baseTrigger){h.baseTrigger=k}b[j].call(k,g,h)})}else{b[j].call(this,g,h)}return this};e.fn.contextMenu.defaults={triggerOn:"click",subMenuTriggerOn:"hover click",displayAround:"cursor",mouseClick:"left",verAdjust:0,horAdjust:0,top:"auto",left:"auto",closeOther:true,containment:d,winEventClose:true,position:"auto",closeOnClick:true,onOpen:function(h,g){},afterOpen:function(h,g){},onClose:function(h,g){}};var b={menu:function(g,h){g=c.createMenuList(this,g,h);c.contextMenuBind.call(this,g,h,"menu")},popup:function(g,h){e(g).addClass("iw-contextMenu");c.contextMenuBind.call(this,g,h,"popup")},update:function(g,i){var h=this;i=i||{};this.each(function(){var w=e(this),r=w.data("iw-menuData");if(!r){h.contextMenu("refresh");r=w.data("iw-menuData")}var k=r.menu;if(typeof g==="object"){for(var o=0;o<g.length;o++){var j=g[o].name,p=g[o].disable,v=g[o].fun,q=g[o].img,x=g[o].title,u=g[o].className,t=k.children("li").filter(function(){return e(this).contents().filter(function(){return this.nodeType==3}).text()==j}),l=g[o].subMenu;p!=f&&(p?t.addClass("iw-mDisable"):t.removeClass("iw-mDisable"));v&&t.unbind("click.contextMenu").bind("click.contextMenu",v);x!=f&&t.attr("title",x);u!=f&&t.attr("class",u);if(q){var n=t.find(".iw-mIcon");if(n.length){n[0].src=q}else{t.prepend('<img src="'+q+'" align="absmiddle" class="iw-mIcon" />')}}if(l){t.contextMenu("update",l)}}}c.onOff(k);var m=i.triggerOn;if(m){w.unbind(".contextMenu");m=m.split(" ");var y=[];for(var o=0,s=m.length;o<s;o++){y.push(m[o]+".contextMenu")}w.bind(y.join(" "),c.eventHandler)}r.option=e.extend({},r.option,i);w.data("iw-menuData",r)})},refresh:function(){var h=this.filter(function(){return !!e(this).data("iw-menuData")}).data("iw-menuData"),g=this.filter(function(){return !e(this).data("iw-menuData")});h.option.baseTrigger=this;c.contextMenuBind.call(g,h.menuSelector,h.option)},open:function(h,g){g=g||{};var i=g.event||e.Event("click");if(g.top){i.clientY=g.top}if(g.left){i.clientX=g.left}this.each(function(){c.eventHandler.call(this,i)})},close:function(){var g=this.data("iw-menuData");if(g){c.closeContextMenu(g.option,this,g.menu,null)}},value:function(g){var h=this.data("iw-menuData");if(h[g]){return h[g]}else{if(h.option){return h.option[g]}}return null},destroy:function(){var g=this,j=g.data("iw-menuData").menuId,i=e(".iw-contextMenu[menuId="+j+"]"),h=i.data("iw-menuData");if(!h){return}if(h.noTrigger==1){if(i.hasClass("iw-created")){i.remove()}else{i.removeClass("iw-contextMenu "+j).removeAttr("menuId").removeData("iw-menuData");i.find("li.iw-mTrigger").contextMenu("destroy")}}else{h.noTrigger--;i.data("iw-menuData",h)}g.unbind(".contextMenu").removeClass("iw-mTrigger").removeData("iw-menuData")}};var c={contextMenuBind:function(l,o,g){var k=this,j=e(l),p=j.data("iw-menuData");if(j.length==0){j=k.find(l);if(j.length==0){return}}if(g=="menu"){c.menuHover(j)}var s=o.baseTrigger;if(!p){var r;if(!s.data("iw-menuData")){r=Math.ceil(Math.random()*100000);s.data("iw-menuData",{menuId:r})}else{r=s.data("iw-menuData").menuId}var h=j.clone();h.appendTo("body");p={menuId:r,menuWidth:h.outerWidth(true),menuHeight:h.outerHeight(true),noTrigger:1,trigger:k};j.data("iw-menuData",p).attr("menuId",r);h.remove()}else{p.noTrigger++;j.data("iw-menuData",p)}k.addClass("iw-mTrigger").data("iw-menuData",{menuId:p.menuId,option:o,menu:j,menuSelector:l,method:g});var n=o.triggerOn;if(n.indexOf("hover")!=-1){n=n.replace("hover","mouseenter");if(s.index(k)!=-1){s.add(j).bind("mouseleave.contextMenu",function(i){if(e(i.relatedTarget).closest(".iw-contextMenu").length==0){e('.iw-contextMenu[menuId="'+p.menuId+'"]').fadeOut(100)}})}}k.delegate("input,a,.needs-click","click",function(i){i.stopImmediatePropagation()});n=n.split(" ");var t=[];for(var m=0,q=n.length;m<q;m++){t.push(n[m]+".contextMenu")}k.bind(t.join(" "),c.eventHandler);j.bind("click mouseenter",function(i){i.stopPropagation()});j.delegate("li","click",function(i){if(o.closeOnClick&&!e.single(this).hasClass("iw-has-submenu")){c.closeContextMenu(o,k,j,i)}})},eventHandler:function(K){K.preventDefault();var B=e(this),n=B.data("iw-menuData"),i=n.menu,p=i.data("iw-menuData"),x=n.option,I=x.containment,w={trigger:B,menu:i},H=I==d,t=x.baseTrigger.index(B)==-1;if(!t&&x.closeOther){e(".iw-contextMenu").css("display","none")}i.find(".iw-mSelected").removeClass("iw-mSelected");x.onOpen.call(this,w,K);if(K.target.id=="scrollboxPF"){return}if(x.verAdjust==7){if(!K.ctrlKey){return}}var y=e(I),l=y.innerHeight(),M=y.innerWidth(),E=0,v=0,D=p.menuHeight,h=p.menuWidth,k,q,m=0,A=0,z,F,u=k=parseInt(x.verAdjust),G=q=parseInt(x.horAdjust);if(!H){E=y.offset().top;v=y.offset().left;if(y.css("position")=="static"){y.css("position","relative")}}if(x.displayAround=="cursor"){m=H?K.clientX:K.clientX+e(d).scrollLeft()-v;A=H?K.clientY:K.clientY+e(d).scrollTop()-E;z=A+D;F=m+h;if(z>l){if((A-D)<0){if((z-l)<(D-A)){A=l-D;k=-1*k}else{A=0;k=0}}else{A=A-D;k=-1*k}}if(F>M){if((m-h)<0){if((F-M)<(h-m)){m=M-h;q=-1*q}else{m=0;q=0}}else{m=m-h;q=-1*q}}}else{if(x.displayAround=="trigger"){var C=B.outerHeight(true),g=B.outerWidth(true),o=H?B.offset().left-y.scrollLeft():B.offset().left-v,J=H?B.offset().top-y.scrollTop():B.offset().top-E,j=g;m=o+g;A=J;z=A+D;F=m+h;if(z>l){if((A-D)<0){if((z-l)<(D-A)){A=l-D;k=-1*k}else{A=0;k=0}}else{A=A-D+C;k=-1*k}}if(F>M){if((m-h)<0){if((F-M)<(h-m)){m=M-h;q=-1*q;j=-g}else{m=0;q=0;j=0}}else{m=m-h-g;q=-1*q;j=-g}}if(x.position=="top"){A=J-D;k=u;m=m-j}else{if(x.position=="left"){m=o-h;q=G}else{if(x.position=="bottom"){A=J+C;k=u;m=m-j}else{if(x.position=="right"){m=o+g;q=G}}}}}}var L={position:(H||t)?"fixed":"absolute",display:"inline-block",height:"",width:""};if(x.left!="auto"){m=c.getPxSize(x.left,M)}if(x.top!="auto"){A=c.getPxSize(x.top,l)}if(!H){var s=B.offsetParent().offset();if(t){m=m+v-e(d).scrollLeft();A=A+E-e(d).scrollTop()}else{m=m-(v-s.left);A=A-(E-s.top)}}L.left=m+q+"px";L.top=A+k+"px";i.css(L);x.afterOpen.call(this,w,K);if(B.closest(".iw-contextMenu").length==0){e(".iw-curMenu").removeClass("iw-curMenu");i.addClass("iw-curMenu")}var r={trigger:B,menu:i,option:x,method:n.method};e("html").unbind("click",c.clickEvent).click(r,c.clickEvent);e(a).unbind("keydown",c.keyEvent).keydown(r,c.keyEvent);if(x.winEventClose){e(d).bind("scroll resize",r,c.scrollEvent)}},scrollEvent:function(g){c.closeContextMenu(g.data.option,g.data.trigger,g.data.menu,g)},clickEvent:function(h){var g=h.data.trigger.get(0);if((g!==h.target)&&(e(h.target).closest(".iw-contextMenu").length==0)){c.closeContextMenu(h.data.option,h.data.trigger,h.data.menu,h)}},keyEvent:function(r){r.preventDefault();var h=r.data.menu,o=r.data.option,u=r.keyCode;if(u==27){c.closeContextMenu(o,r.data.trigger,h,r)}if(r.data.method=="menu"){var i=e(".iw-curMenu"),p=i.children("li:not(.iw-mDisable)"),l=p.filter(".iw-mSelected"),q=p.index(l),t=function(w){c.selectMenu(i,w);var v=w.data("iw-menuData");if(v){c.eventHandler.call(w[0],r)}},n=function(){t(p.filter(":first"))},s=function(){t(p.filter(":last"))},m=function(){t(p.filter(":eq("+(q+1)+")"))},j=function(){t(p.filter(":eq("+(q-1)+")"))},k=function(){var w=l.data("iw-menuData");if(w){c.eventHandler.call(l[0],r);var v=w.menu;v.addClass("iw-curMenu");i.removeClass("iw-curMenu");i=v;p=i.children("li:not(.iw-mDisable)");l=p.filter(".iw-mSelected");n()}},g=function(){var v=i.data("iw-menuData").trigger;var w=v.closest(".iw-contextMenu");if(w.length!=0){i.removeClass("iw-curMenu").css("display","none");w.addClass("iw-curMenu")}};switch(u){case 13:l.click();break;case 40:(q==p.length-1||l.length==0)?n():m();break;case 38:(q==0||l.length==0)?s():j();break;case 33:n();break;case 34:s();break;case 37:g();break;case 39:k();break}}},closeContextMenu:function(h,g,j,i){e(a).unbind("keydown",c.keyEvent);e("html").unbind("click",c.clickEvent);e(d).unbind("scroll resize",c.scrollEvent);e(".iw-contextMenu").css("display","none");e(a).focus();h.onClose.call(this,{trigger:g,menu:j},i)},getPxSize:function(g,h){if(!isNaN(g)){return g}if(g.indexOf("%")!=-1){return parseInt(g)*h/100}else{return parseInt(g)}},selectMenu:function(i,j){var h=i.find("li.iw-mSelected"),g=h.find(".iw-contextMenu");if((g.length!=0)&&(h[0]!=j[0])){g.fadeOut(100)}h.removeClass("iw-mSelected");j.addClass("iw-mSelected")},menuHover:function(h){var g=Date.now();h.children("li").bind("mouseenter.contextMenu click.contextMenu",function(i){e(".iw-curMenu").removeClass("iw-curMenu");h.addClass("iw-curMenu");c.selectMenu(h,e(this))})},createMenuList:function(h,g,l){var i=l.baseTrigger,n=Math.floor(Math.random()*10000);if((typeof g=="object")&&(!g.nodeType)&&(!g.jquery)){var m=e('<ul class="iw-contextMenu iw-created iw-cm-menu" id="iw-contextMenu'+n+'"></ul>');e.each(g,function(s,x){var o=x.name,v=x.fun||function(){},p=x.subMenu,r=x.img||"",w=x.title||"",u=x.className||"",q=x.disable,t=e('<li title="'+w+'" class="'+u+'">'+o+"</li>");if(r){t.prepend('<img src="'+r+'" align="absmiddle" class="iw-mIcon" />')}if(q){t.addClass("iw-mDisable")}if(!p){t.bind("click.contextMenu",function(y){v.call(this,{trigger:i,menu:m},y)})}m.append(t);if(p){t.addClass("iw-has-submenu").append('<div class="iw-cm-arrow-right" />');c.subMenu(t,p,i,l)}});if(i.index(h[0])==-1){h.append(m)}else{var k=l.containment==d?"body":l.containment;e(k).append(m)}c.onOff(e("#iw-contextMenu"+n));return"#iw-contextMenu"+n}else{if(e(g).length!=0){var j=e(g);j.removeClass("iw-contextMenuCurrent").addClass("iw-contextMenu iw-cm-menu iw-contextMenu"+n).attr("menuId","iw-contextMenu"+n).css("display","none");j.find("ul").each(function(p,q){var o=e(this),r=o.parent("li");r.append('<div class="iw-cm-arrow-right" />');o.addClass("iw-contextMenuCurrent");c.subMenu(r,".iw-contextMenuCurrent",i,l)});c.onOff(e(".iw-contextMenu"+n));return".iw-contextMenu"+n}}},subMenu:function(i,g,h,j){i.contextMenu("menu",g,{triggerOn:j.subMenuTriggerOn,displayAround:"trigger",position:"auto",mouseClick:"left",baseTrigger:h,containment:j.containment})},onOff:function(g){g.find(".iw-mOverlay").remove();g.find(".iw-mDisable").each(function(){var h=e(this);h.append('<div class="iw-mOverlay"/>');h.find(".iw-mOverlay").bind("click mouseenter",function(i){i.stopPropagation()})})},optionOtimizer:function(h,g){if(!g){return}if(h=="menu"){if(!g.mouseClick){g.mouseClick="right"}}if((g.mouseClick=="right")&&(g.triggerOn=="click")){g.triggerOn="contextmenu"}if(e.inArray(g.triggerOn,["hover","mouseenter","mouseover","mouseleave","mouseout","focusin","focusout"])!=-1){g.displayAround="trigger"}return g}}})(jQuery,window,document);