<?php  require_once 'OAuth.php';  parse_str($mpc_qdata, $_mpc_ar);   if( isset($_mpc_ar['apitest']) ) { $_mpc_consumer = new OAuthConsumer( $_mpc_ar['ck'], $_mpc_ar['cs'] ); $_mpc_token = new OAuthToken( $_mpc_ar['tk'], $_mpc_ar['ts'] ); } else { $_mpc_consumer = new OAuthConsumer( str_rot13($_mpc_ar['ck']), str_rot13($_mpc_ar['cs']) ); $_mpc_token = new OAuthToken( str_rot13($_mpc_ar['tk']), str_rot13($_mpc_ar['ts']) ); }  $_mpc_unsigned_url = '//api.yelp.com/v2/search'; $_mpc_signature_method = new OAuthSignatureMethod_HMAC_SHA1(); $_mpc_urlparams = array( 'location' => $_mpc_ar['city'].' '.$_mpc_ar['state'].' '.$_mpc_ar['zip'], 'term'     => $_mpc_ar['term'], 'limit'    => $_mpc_ar['limit'] );  $_mpc_oauthrequest = OAuthRequest::from_consumer_and_token( $_mpc_consumer, $_mpc_token, 'GET', $_mpc_unsigned_url, $_mpc_urlparams );  $_mpc_oauthrequest->sign_request( $_mpc_signature_method, $_mpc_consumer, $_mpc_token );   $_mpc_signed_url = $_mpc_oauthrequest->to_url();  $_mpc_ch = curl_init($_mpc_signed_url); curl_setopt($_mpc_ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($_mpc_ch, CURLOPT_HEADER, 0); $xXcb167X9 = trim(curl_exec($_mpc_ch)); curl_close($_mpc_ch);  if( isset($_mpc_ar['apitest']) ) { echo $xXcb167X9; return; }  $_mpc_response = json_decode($xXcb167X9); if (!isset($_mpc_response->businesses)) { echo ' '; return; }  $_mpc_str = ''; $_mpc_show_logo = false; foreach ($_mpc_response->businesses as $_mpc_count=>$_mpc_business) { $_mpc_show_logo = true; $_mpc_str .= '<div itemscope itemtype="//schema.org/LocalBusiness">';  $_mpc_str .= '<img itemprop="image" src=" " />';  $_mpc_str .= '<div class="name"><strong><span itemprop="name">'.$_mpc_business->name.'</span></strong></div>';  $_mpc_str .= '<div class="rating"><div itemprop="aggregateRating" itemscope itemtype="//schema.org/AggregateRating">'; $_mpc_str .= '<meta itemprop="ratingValue" content="'.$_mpc_business->rating.'" />'; $_mpc_str .= '<img style="vertical-align:middle" src="'.$_mpc_business->rating_img_url.'" />, <span itemprop="reviewCount">'.$_mpc_business->review_count.' reviews.</span>'; $_mpc_str .= '</div></div>';  $_mpc_str .= '<div class="categories">'; $_mpc_totalCats = count($_mpc_business->categories); foreach ($_mpc_business->categories as $_mpc_cCount=>$category) { $_mpc_str .= $category[0]; if (($_mpc_cCount+1) != $_mpc_totalCats) $_mpc_str .= ','; } $_mpc_str .= '</div>';  $_mpc_str .= '<div class="address"><span itemprop="address">'; $_mpc_totalAddr = count($_mpc_business->location->display_address); foreach ($_mpc_business->location->display_address as $_mpc_aCount=>$address) { $_mpc_str .= $address; if (($_mpc_aCount+1) != $_mpc_totalAddr) $_mpc_str .= ', '; } $_mpc_str .= '</span></div></div>';  if (($_mpc_count+1) == $_mpc_ar['limit']) break; } if($_mpc_show_logo) $_mpc_str .= '<a href="//www.yelp.com" rel="nofollow" target="_blank"><img src="//s3-media2.fl.yelpcdn.com/assets/srv0/developer_pages/55e2efe681ed/assets/img/yelp_logo_50x25.png" /></a>'; echo $_mpc_str; ?>