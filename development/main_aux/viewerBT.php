<?php require_once "./class_dbase.php";  $TESTING = $_GET['TESTING']; $VER = $_GET['VER']; $PERPAGE = $_GET['PERPAGE']; $LINES = $_GET['LINES']; $CARET = $_GET['CARET']; $SILOD = $_GET['SILOD']; $iPOSTS = $_GET['iPOSTS']; $bPOSTS = ($iPOSTS == 1);  if($TESTING == 1) { $cf_button = '<link  href="../cssfiles/button.css" rel="stylesheet" type="text/css" />'; } else { $cf_button = "<link rel=\"stylesheet\" href=\"css/mpc.button.$VER.min.css\" type=\"text/css\" />"; } if($LINES < $PERPAGE) { $iPages = 1; $currPage = 0; $nextPage = 0; $prevPage = 0; } else { $iPages = floor( ($LINES + $PERPAGE)/$PERPAGE ); $currPage = (isset($_GET['currPage']))? $_GET['currPage'] : 0; $prevPage = $currPage -1; if($prevPage < 0) $prevPage = $iPages -1; $nextPage = $currPage + 1; if($nextPage >= $iPages) $nextPage = 0; } $qs = "&TESTING=$TESTING&VER=$VER&PERPAGE=$PERPAGE&LINES=$LINES&SILOD=$SILOD&iPOSTS=$iPOSTS&CARET=$CARET";  $dbBlue = new dbase('.', 'bt.db'); $retjson = $dbBlue->dumpBpPagesT($currPage, $currPage, 'bx.txt', $PERPAGE); $rj = json_decode($retjson); $yb1d40XxF = $rj->varcount;  $vc5 = $yb1d40XxF+5; $vlab = array_fill(0,8,' '); for($x=1;$x<$yb1d40XxF;$x++) { $vlab[$x-1] = @file_get_contents('snap/cp_txVar'.$x); } ?> <!DOCTYPE html> <html> <head> <meta charset="utf-8" /> <title>MPC - Article Blueprint</title> <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'> <?php echo $cf_button ?> <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js" ></script> <link rel="icon" type="image/png" href="images/favicon16.png" sizes="16x16"> <link rel="icon" type="image/png" href="images/favicon32.png" sizes="32x32">  <style type="text/css"> body { font-family:monospace; cursor:wait; font-size:12.8px; margin:0; padding:0; color:black; background-color:white; } .noitem {background-color:pink} .noitem { border-radius:5px; -moz-border-radius:5px; -webkit-border-radius:5px; }  a, a:link, a:visited {color:blue;text-decoration:none;} a:hover {text-decoration:underline} td {text-align:left;padding:0;white-space:nowrap;}  .sexybutton { z-index:99; } .tb_num  {text-align:right;padding:1px 10px;width:20px}  .th     {text-align:left;  padding:0 10px;font-weight:bold;width:10px} .thn    {text-align:right; padding:0 10px;font-weight:bold;width:10px} .thx    {text-align:left;  padding:0 10px;font-weight:bold;height:48px} .tb     {text-align:left;  padding:0 10px;width:10px} .tbx    {text-align:left;  padding:0 10px}  .hd { font-family:Verdana,Arial,sans-serif; border:1px solid #808080; padding:1px 3px; margin:0; border-bottom-right-radius:5px; -moz-border-radius-bottomright:5px; -webkit-bottom-right-border-radius:5px; border-top-right-radius:5px; -moz-border-radius-topright:5px; -webkit-top-right-border-radius:5px; }  .silo, .siloi  { background-color:#ffec80; border-top-left-radius:5px; -moz-border-radius-topleft:5px; -webkit-top-left-border-radius:5px; border-bottom-left-radius:5px; -moz-border-radius-bottomleft:5px; -webkit-bottom-left-border-radius:5px; } .siloi { background-color:#b8e8ff; }  .nocat, .nopar { background-color:#e0e0e0; border-top-left-radius:5px; -moz-border-radius-topleft:5px; -webkit-top-left-border-radius:5px; border-bottom-left-radius:5px; -moz-border-radius-bottomleft:5px; -webkit-bottom-left-border-radius:5px; } </style>  <script> var vc = <?php echo $yb1d40XxF ?>; var lines = <?php echo $LINES ?>; var perpage = <?php echo $PERPAGE ?>;  function busy(q) { jQuery('.pn' ).prop('disabled', true); jQuery('.pnc' ).prop('disabled', true); jQuery('body' ).css('cursor', 'wait'); location.href='viewerBT.php?currPage='+q; } jQuery(document).ready(function() { var ar = new Array('num', 'src', 'ttl', 'url', 'aut'); var j,x; for(x=0;x<5;x++) { j = jQuery('#th_'+ar[x]); j.css('width', j[0].getBoundingClientRect().width); jQuery('#tb_'+ar[x]+'1').css('width', j[0].getBoundingClientRect().width) } for(x=1;x<vc;x++) { j = jQuery('#th_var'+x); j.css('width', j[0].getBoundingClientRect().width); jQuery('#tb_var'+x).css('width', j[0].getBoundingClientRect().width) } jQuery('#tban').css('position', 'fixed'); jQuery('#tpad').css('display', 'block'); jQuery('.pnc' ).prop('disabled', false); if(lines > (perpage-1)) jQuery('.pn' ).prop('disabled', false); jQuery('body' ).css('cursor', 'default');  var oldScroll = 0; jQuery(function() { jQuery(window).scroll(function() { var hs = jQuery(window).scrollLeft(); if(oldScroll != hs) { oldScroll = hs; jQuery('#tban').css('left', '-'+hs+'px'); jQuery('#ctrl').css('left', '-'+hs+'px'); } }); }); }); </script> </head> <body>  <!-- controls --> <div id="ctrl" style="position:fixed;top:0;left:0;height:37px;width:100%;padding:5px 4px;background:none;z-index:99"> <table> <tr> <td> &nbsp;<button class="sexybutton sexyicononly pn" disabled="disabled" title="Previous page of lines" onclick="busy('<?php echo $prevPage.$qs ?>')"> <span><span><span class="prev">&nbsp;</span></span></span></button> </td> <td> &nbsp;<button class="sexybutton sexyicononly pn" disabled="disabled" title="Next page of lines" onclick="busy('<?php echo $nextPage.$qs ?>')"> <span><span><span class="next">&nbsp;</span></span></span></button> </td> <td> &nbsp;<button class="sexybutton pnc" disabled="disabled" title="Close listing" onclick="window.close();return false"><span><span><span class="cancel">Close</span></span></span></button> </td> <?php $parhdr = 'Parent/Slug'; $paridx = ''; if($SILOD == 1) { $parhdr = 'Parent/Slug or Silo Index'; if(!$bPOSTS) $paridx = '&nbsp<span class="siloi hd">silo index</span'; echo '<td>&nbsp<span class="silo hd">silo</span>'.$paridx.'</td>'; } ?> <td>&nbsp;&nbsp;<b>WP Blueprint <?php echo ($bPOSTS)? '(Posts)' : '(Pages)' ?></b></td> </tr> </table> </div>  <div id="tpad" style="height:51px;width:100%;background-color:c4c4c4;display:none">&nbsp;</div>  <!-- thead --> <table style="width:100%;text-align:left"> <thead id="tban" style="position:auto;top:0;left:0;width:4000px;background-color:#c4c4c4"> <tr> <td class="thn"><div id="th_num"><br><br><?php echo number_format($LINES) ?></div></td> <td class="th"><div id="th_src"><br><br>Source</div></td> <td class="th"><div id="th_url"><br><br><?php echo ($bPOSTS)? 'Category/Slug' : $parhdr ?></div></td> <td class="th"><div id="th_ttl"><br><br>Title</div></td> <td class="th"><div id="th_aut"><br><br>Autospin</div></td> <?php for($x=1;$x<$yb1d40XxF;$x++) { echo '<td class="th"><div id="th_var'.$x.'"><br>'.$vlab[$x-1].'<br>var'.$x.'</div></td>'; } ?> <td class="thx">&nbsp;</td> </tr> <tr><td colspan="<?php echo $vc5 ?>"><div style="height:2px;border-bottom:1px solid #808080"></div></td></tr> </thead>  <!-- tbody --> <tbody> <?php $xx2D3XA2F = fopen('./tmp/bx.txt', 'r'); $linecnt = ($currPage == 0)? 1 : 0; $rownum = 1; while(($line = fgets($xx2D3XA2F)) !== false) { $rn = $rownum; list($src, $title, $xcab180X1, $spin, $category, $parent, $path1, $vv) = explode("\t", trim($line), 8); $ar = explode("\t", $vv); $row = ($rownum++ & 1 == 1)? 'white':'#f0f0f0'; echo "<tr style=\"background-color:$row\">";   $n = $currPage*$PERPAGE+$linecnt++; $c = sprintf('%03d',$n); if($n > 999) $c = number_format($c); echo '<td class="tb_num"><div id="tb_num'.$rn.'">'.$c.'</div></td>';  if($rn == 1) echo '<td class="tb"><div id="tb_src1">'.$src.'</div></td>'; else         echo '<td class="tb">'.$src.'</td>';  if($bPOSTS) { $cat = '<span class="nocat">&nbsp;Uncategorized&nbsp;</span>'; if($category != "") { $cat = yaff84XxX($category); } else if($SILOD == 1) { $cat = yaff84XxX($path1); }  $slg = ($xcab180X1 != "")? yaff84XxX($xcab180X1) : yaff84XxX($title);  if($SILOD == 1) $cat = '<span class="silo">&nbsp;'.$cat.'&nbsp;</span>';  $xx85188XA = "$cat/$slg"; } else { if($SILOD == 1) { if( substr($path1, -1) == '@') { $xx85188XA = '<span class="siloi">&nbsp;'.trim($path1, "@").'&nbsp;</span>'; } else { $slg = ($xcab180X1 != "")? $xcab180X1 : $title; $slg = yaff84XxX($slg); $xx85188XA = '<span class="silo">&nbsp;'.$path1.'&nbsp;</span>/'.$slg; } } else { $par = ($parent == "")? '<span class="nopar">&nbsp;(no parent)&nbsp;</span>' : $par = yaff84XxX($parent); $slg = ($xcab180X1 != "")? $xcab180X1 : $title; $slg = yaff84XxX($slg); $xx85188XA = "$par/$slg"; } }  if($rn == 1) echo '<td class="tb"><div id="tb_url1">'.$xx85188XA.'</div></td>'; else         echo '<td class="tb">'.$xx85188XA.'</td>';        if($title == "") $title = '<span class="noitem">&nbsp;Title not found&nbsp;</span>'; else if($title != strip_tags($title)) $title = '<span class="noitem">&nbsp;Title contains html tags&nbsp;</span>'; if($rn == 1) echo '<td class="tb"><div id="tb_ttl1">'.$title.'</div></td>'; else         echo '<td class="tb">'.$title.'</td>';  $as = intval($spin); if($as == 0) $as = 'always'; else if($as < 0) $as = 'never'; else $as = ($as == 1)? $as.'-day' : $as.'-days'; if($rn == 1) echo '<td class="tb"><div id="tb_aut1">'.$as.'</div></td>'; else         echo '<td class="tb">'.$as.'</td>';  for($x=1;$x<$yb1d40XxF;$x++) { if($rn == 1) echo '<td class="tb"><div id="tb_var'.$x.'">'.$dbBlue->getVarValue($ar[$x]).'</div></td>'; else         echo '<td class="tb">'.$dbBlue->getVarValue($ar[$x]).'</td>'; }  echo '<td class="tbx">&nbsp;</td>'; echo '</tr>'; } echo '</tbody>'; echo '</table>'; fclose($xx2D3XA2F); $dbBlue->close(false);   function yaff84XxX($xx85188XA) { $s = str_replace(' ', '-', $xx85188XA); $s = trim(preg_replace('/[^a-z0-9-_]+/', '', strtolower($s)),' -'); return preg_replace('/-+/', '-', $s); } function DEBUG($msg,$file = './DEBUG') { $xcf35XCFE = fopen($file,'ab'); fwrite($xcf35XCFE,$msg,strlen($msg)); fwrite($xcf35XCFE,"\n",1); fclose($xcf35XCFE); } ?> </body> </html>